function buildIOSMeta(){for(var e=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],t=0;t<e.length;t++){var i=document.createElement("meta"),n=(i.name=e[t].name,i.content=e[t].content,window.document.head.querySelector('meta[name="'+i.name+'"]'));n&&n.parentNode.removeChild(n),window.document.head.appendChild(i)}}function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none"),jQuery(".xxx-ios-fullscreen-scroll").css("display","none"),jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block"),jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}function __iosResize(){if(window.scrollTo(0,0),console.log(window.devicePixelRatio),console.log(window.innerWidth),console.log(window.innerHeight),"iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:(375===window.innerHeight?hideIOSFullscreenPanel:showIOSFullscreenPanel)();break;case 808:(414===window.innerHeight?hideIOSFullscreenPanel:showIOSFullscreenPanel)();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:(414===window.innerHeight?hideIOSFullscreenPanel:showIOSFullscreenPanel)();break;case 724:(375===window.innerHeight?hideIOSFullscreenPanel:showIOSFullscreenPanel)();break;case 808:(414===window.innerHeight?hideIOSFullscreenPanel:showIOSFullscreenPanel)();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize(),setTimeout(function(){__iosResize()},500)}function iosInIframe(){try{return window.self!==window.top}catch(e){return!0}}function isIOSLessThen13(){var e=(t=platform.os).family.toLowerCase(),t=parseFloat(t.version);return"ios"===e&&t<13}!function(){var a="undefined"!=typeof window&&void 0!==window.document?window.document:{},e="undefined"!=typeof module&&module.exports,r=function(){for(var e,t=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],i=0,n=t.length,r={};i<n;i++)if((e=t[i])&&e[1]in a){for(i=0;i<e.length;i++)r[t[0][i]]=e[i];return r}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},t={request:function(n){return new Promise(function(e,t){var i=function(){this.off("change",i),e()}.bind(this);this.on("change",i),n=n||a.documentElement,Promise.resolve(n[r.requestFullscreen]()).catch(t)}.bind(this))},exit:function(){return new Promise(function(e,t){var i;this.isFullscreen?(i=function(){this.off("change",i),e()}.bind(this),this.on("change",i),Promise.resolve(a[r.exitFullscreen]()).catch(t)):e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,t){e=i[e];e&&a.addEventListener(e,t,!1)},off:function(e,t){e=i[e];e&&a.removeEventListener(e,t,!1)},raw:r};r?(Object.defineProperties(t,{isFullscreen:{get:function(){return!!a[r.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!a[r.fullscreenEnabled]}}}),e?module.exports=t:window.screenfull=t):e?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}(),$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())}),jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()}),function(){function t(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function w(e){return e=String(e).replace(/^ +| +$/g,""),/^(?:webOS|i(?:OS|P))/.test(e)?e:t(e)}function v(e,t){for(var i in e)r.call(e,i)&&t(e[i],i,e)}function y(e){return null==e?t(e):P.call(e).slice(8,-1)}function N(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function L(i,n){var r=null,e=i,t=function(e,t){r=n(r,e,t,i)},a=-1,s=e?e.length:0;if("number"==typeof s&&-1<s&&s<=o)for(;++a<s;)t(e[a],a,e);else v(e,t);return r}function W(a){function e(e){return L(e,function(e,t){var i=t.pattern||N(t);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((e=String(t.label&&!RegExp(i,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=w(e[0].replace(RegExp(i,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}var t,i,n,r,s,o=D,l=((T=a&&"object"==typeof a&&"String"!=y(a))&&(o=a,a=null),o.navigator||{}),_=l.userAgent||"",c=(a=a||_,T?!!l.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(P.toString())),d=T?"Object":"ScriptBridgingProxyObject",u=T?"Object":"Environment",f=T&&o.java?"JavaPackage":y(o.java),h=T?"Object":"RuntimeObject",u=(f=/\bJava/.test(f)&&o.java)&&y(o.environment)==u,p=f?"a":"α",S=f?"b":"β",m=o.document||{},x=o.operamini||o.opera,b=M.test(b=T&&x?x["[[Class]]"]:y(x))?b:x=null,g=a,T=[],A=null,E=a==_,_=E&&x&&"function"==typeof x.version&&x.version(),H=L([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,t){return e||RegExp("\\b"+(t.pattern||N(t))+"\\b","i").exec(a)&&(t.label||t)}),O=L(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],function(e,t){return e||RegExp("\\b"+(t.pattern||N(t))+"\\b","i").exec(a)&&(t.label||t)}),C=e([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),I=L({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},function(e,t,i){return e||(t[C]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(C)]||RegExp("\\b"+N(i)+"(?:\\b|\\w*\\d)","i").exec(a))&&i}),R=L(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],function(e,t){var i,n,r=t.pattern||N(t);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(i=e,t=t.label||t,n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},r&&t&&/^Win/i.test(i)&&!/^Windows Phone /i.test(i)&&(n=n[/[\d.]+$/.exec(i)])&&(i="Windows "+n),i=String(i),e=i=w((i=r&&t?i.replace(RegExp(r,"i"),t):i).replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])),e}),H=H&&[H];if(I&&!C&&(C=e([I])),(t=/\bGoogle TV\b/.exec(C))&&(C=t[0]),/\bSimulator\b/i.test(a)&&(C=(C?C+" ":"")+"Simulator"),"Opera Mini"==O&&/\bOPiOS\b/.test(a)&&T.push("running in Turbo/Uncompressed mode"),"IE"==O&&/\blike iPhone OS\b/.test(a)?(I=(t=W(a.replace(/like iPhone OS/,""))).manufacturer,C=t.product):/^iP/.test(C)?(O=O||"Safari",R="iOS"+((t=/ OS ([\d_]+)/i.exec(a))?" "+t[1].replace(/_/g,"."):"")):"Konqueror"!=O||/buntu/i.test(R)?I&&"Google"!=I&&(/Chrome/.test(O)&&!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(C))||/\bAndroid\b/.test(R)&&/^Chrome/.test(O)&&/\bVersion\//i.test(a)?(O="Android Browser",R=/\bAndroid\b/.test(R)?R:"Android"):"Silk"==O?(/\bMobi/i.test(a)||(R="Android",T.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&T.unshift("accelerated")):"PaleMoon"==O&&(t=/\bFirefox\/([\d.]+)\b/.exec(a))?T.push("identifying as Firefox "+t[1]):"Firefox"==O&&(t=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(R=R||"Firefox OS",C=C||t[1]):!O||(t=!/\bMinefield\b/i.test(a)&&/\b(?:Firefox|Safari)\b/.exec(O))?(O&&!C&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(t+"/")+8))&&(O=null),(t=C||I||R)&&(C||I||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(R))&&(O=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(R)?R:t)+" Browser")):"Electron"==O&&(t=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&T.push("Chromium "+t):R="Kubuntu",_||(_=L(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",N(O),"(?:Firefox|Minefield|NetFront)"],function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})),(t=("iCab"==H&&3<parseFloat(_)?"WebKit":/\bOpera\b/.test(O)&&(/\bOPR\b/.test(a)?"Blink":"Presto"))||(/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(H)?"WebKit":!H&&/\bMSIE\b/i.test(a)&&("Mac OS"==R?"Tasman":"Trident"))||"WebKit"==H&&/\bPlayStation\b(?! Vita\b)/i.test(O)&&"NetFront")&&(H=[t]),"IE"==O&&(t=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(O+=" Mobile",R="Windows Phone "+(/\+$/.test(t)?t:t+".x"),T.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(O="IE Mobile",R="Windows Phone 8.x",T.unshift("desktop mode"),_=_||(/\brv:([\d.]+)/.exec(a)||0)[1]):"IE"!=O&&"Trident"==H&&(t=/\brv:([\d.]+)/.exec(a))&&(O&&T.push("identifying as "+O+(_?" "+_:"")),O="IE",_=t[1]),E){if(n="global",r=null!=(i=o)?typeof i[n]:"number",/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!i[n])y(t=o.runtime)==d?(O="Adobe AIR",R=t.flash.system.Capabilities.os):y(t=o.phantom)==h?(O="PhantomJS",_=(t=t.version||null)&&t.major+"."+t.minor+"."+t.patch):"number"==typeof m.documentMode&&(t=/\bTrident\/(\d+)/i.exec(a))?(_=[_,m.documentMode],(t=+t[1]+4)!=_[1]&&(T.push("IE "+_[1]+" mode"),H&&(H[1]=""),_[1]=t),_="IE"==O?String(_[1].toFixed(1)):_[0]):"number"==typeof m.documentMode&&/^(?:Chrome|Firefox)\b/.test(O)&&(T.push("masking as "+O+" "+_),O="IE",_="11.0",H=["Trident"],R="Windows");else if(f&&(g=(t=f.lang.System).getProperty("os.arch"),R=R||t.getProperty("os.name")+" "+t.getProperty("os.version")),u){try{_=o.require("ringo/engine").version.join("."),O="RingoJS"}catch(e){(t=o.system)&&t.global.system==o.system&&(O="Narwhal",R=R||t[0].os||null)}O=O||"Rhino"}else"object"==typeof o.process&&!o.process.browser&&(t=o.process)&&("object"==typeof t.versions&&("string"==typeof t.versions.electron?(T.push("Node "+t.versions.node),O="Electron",_=t.versions.electron):"string"==typeof t.versions.nw&&(T.push("Chromium "+_,"Node "+t.versions.node),O="NW.js",_=t.versions.nw)),O||(O="Node.js",g=t.arch,R=t.platform,_=(_=/[\d.]+/.exec(t.version))?_[0]:null));R=R&&w(R)}if(_&&(t=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(_)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(E&&l.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(A=/b/i.test(t)?"beta":"alpha",_=_.replace(RegExp(t+"\\+?$"),"")+("beta"==A?S:p)+(/\d+\+?/.exec(t)||"")),"Fennec"==O||"Firefox"==O&&/\b(?:Android|Firefox OS)\b/.test(R))O="Firefox Mobile";else if("Maxthon"==O&&_)_=_.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(C))"Xbox 360"==C&&(R=null),"Xbox 360"==C&&/\bIEMobile\b/.test(a)&&T.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(O)&&(!O||C||/Browser|Mobi/.test(O))||"Windows CE"!=R&&!/Mobi/i.test(a))if("IE"==O&&E)try{null===o.external&&T.unshift("platform preview")}catch(e){T.unshift("embedded")}else(/\bBlackBerry\b/.test(C)||/\bBB10\b/.test(a))&&(t=(RegExp(C.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||_)?(R=((t=[t,/BB10/.test(a)])[1]?(C=null,I="BlackBerry"):"Device Software")+" "+t[0],_=null):this!=v&&"Wii"!=C&&(E&&x||/Opera/.test(O)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==O&&/\bOS X (?:\d+\.){2,}/.test(R)||"IE"==O&&(R&&!/^Win/.test(R)&&5.5<_||/\bWindows XP\b/.test(R)&&8<_||8==_&&!/\bTrident\b/.test(a)))&&!M.test(t=W.call(v,a.replace(M,"")+";"))&&t.name&&(t="ing as "+t.name+((t=t.version)?" "+t:""),M.test(O)?(/\bIE\b/.test(t)&&"Mac OS"==R&&(R=null),t="identify"+t):(t="mask"+t,O=b?w(b.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(t)&&(R=null),E||(_=null)),H=["Presto"],T.push(t));else O+=" Mobile";return(t=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(t=[parseFloat(t.replace(/\.(\d)$/,".0$1")),t],"Safari"==O&&"+"==t[1].slice(-1)?(O="WebKit Nightly",A="alpha",_=t[1].slice(0,-1)):_!=t[1]&&_!=(t[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1])||(_=null),t[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1],537.36==t[0]&&537.36==t[2]&&28<=parseFloat(t[1])&&"WebKit"==H&&(H=["Blink"]),t=E&&(c||t[1])?(H&&(H[1]="like Chrome"),t[1]||((t=t[0])<530?1:t<532?2:t<532.05?3:t<533?4:t<534.03?5:t<534.07?6:t<534.1?7:t<534.13?8:t<534.16?9:t<534.24?10:t<534.3?11:t<535.01?12:t<535.02?"13+":t<535.07?15:t<535.11?16:t<535.19?17:t<536.05?18:t<536.1?19:t<537.01?20:t<537.11?"21+":t<537.13?23:t<537.18?24:t<537.24?25:t<537.36?26:"Blink"!=H?"27":"28")):(H&&(H[1]="like Safari"),(t=t[0])<400?1:t<500?2:t<526?3:t<533?4:t<534?"4+":t<535?5:t<537?6:t<538?7:t<601?8:"8"),H&&(H[1]+=" "+(t+="number"==typeof t?".x":/[.+]/.test(t)?"":"+")),"Safari"==O)&&(!_||45<parseInt(_))&&(_=t),"Opera"==O&&(t=/\bzbov|zvav$/.exec(R))?(O+=" ",T.unshift("desktop mode"),"zvav"==t?(O+="Mini",_=null):O+="Mobile",R=R.replace(RegExp(" *"+t+"$"),"")):"Safari"==O&&/\bChrome\b/.exec(H&&H[1])&&(T.unshift("desktop mode"),O="Chrome Mobile",_=null,R=/\bOS X\b/.test(R)?(I="Apple","iOS 4.3+"):null),_&&0==_.indexOf(t=/[\d.]+$/.exec(R))&&-1<a.indexOf("/"+t+"-")&&(R=String(R.replace(t,"")).replace(/^ +| +$/g,"")),H&&!/\b(?:Avant|Nook)\b/.test(O)&&(/Browser|Lunascape|Maxthon/.test(O)||"Safari"!=O&&/^iOS/.test(R)&&/\bSafari\b/.test(H[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(O)&&H[1])&&(t=H[H.length-1])&&T.push(t),T.length&&(T=["("+T.join("; ")+")"]),I&&C&&C.indexOf(I)<0&&T.push("on "+I),C&&T.push((/^on /.test(T[T.length-1])?"":"on ")+C),R&&(s=(t=/ ([\d.+]+)$/.exec(R))&&"/"==R.charAt(R.length-t[0].length-1),R={architecture:32,family:t&&!s?R.replace(t[0],""):R,version:t?t[1]:null,toString:function(){var e=this.version;return this.family+(e&&!s?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(t=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(g))&&!/\bi686\b/i.test(g)?(R&&(R.architecture=64,R.family=R.family.replace(RegExp(" *"+t),"")),O&&(/\bWOW64\b/i.test(a)||E&&/\w(?:86|32)$/.test(l.cpuClass||l.platform)&&!/\bWin64; x64\b/i.test(a))&&T.unshift("32-bit")):R&&/^OS X/.test(R.family)&&"Chrome"==O&&39<=parseFloat(_)&&(R.architecture=64),a=a||null,(o={}).description=a,o.layout=H&&H[0],o.manufacturer=I,o.name=O,o.prerelease=A,o.product=C,o.ua=a,o.version=O&&_,o.os=R||{architecture:null,family:null,version:null,toString:function(){return"null"}},o.parse=W,o.toString=function(){return this.description||""},o.version&&T.unshift(_),o.name&&T.unshift(O),R&&O&&(R!=String(R).split(" ")[0]||R!=O.split(" ")[0]&&!C)&&T.push(C?"("+R+")":"on "+R),T.length&&(o.description=T.join(" ")),o}var D=(e={function:!0,object:!0})[typeof window]&&window||this,i=e[typeof exports]&&exports,e=e[typeof module]&&module&&!module.nodeType&&module,n=i&&e&&"object"==typeof global&&global,o=(!n||n.global!==n&&n.window!==n&&n.self!==n||(D=n),Math.pow(2,53)-1),M=/\bOpera/,r=(n=Object.prototype).hasOwnProperty,P=n.toString,a=W();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(D.platform=a,define(function(){return a})):i&&e?v(a,function(e,t){i[t]=e}):D.platform=a}.call(this);var s_oCanvasLeft,s_oCanvasTop,s_iScaleFactor=1,s_iOffsetX=0,s_iOffsetY=0,s_bIsIphone=!1,s_bFocus=!0;function trace(e){console.log(e)}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isIOS(){var e="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");if(-1!==navigator.userAgent.toLowerCase().indexOf("iphone"))return s_bIsIphone=!0;for(;e.length;)if(navigator.platform===e.pop())return!0;return s_bIsIphone=!1}function getSize(e){var t,i,n=e.toLowerCase(),r=window.document,a=r.documentElement;return void 0===window["inner"+e]?e=a["client"+e]:window["inner"+e]!=a["client"+e]?((t=r.createElement("body")).id="vpw-test-b",t.style.cssText="overflow:scroll",(i=r.createElement("div")).id="vpw-test-d",i.style.cssText="position:absolute;top:-1000px",i.innerHTML="<style>@media("+n+":"+a["client"+e]+"px){body#vpw-test-b div#vpw-test-d{"+n+":7px!important}}</style>",t.appendChild(i),a.insertBefore(t,r.head),e=7==i["offset"+e]?a["client"+e]:window["inner"+e],a.removeChild(t)):e=window["inner"+e],e}function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler(),window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var e=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<e?e:0}function isIpad(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!!(!e&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints)||e}function isMobile(){return!!isIpad()||jQuery.browser.mobile}function sizeHandler(){var e,t,i,n,r,a,s;window.scrollTo(0,1),$("#canvas")&&(e=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height"),t=getSize("Width"),s_bFocus&&_checkOrientation(t,e),n=Math.min(e/CANVAS_HEIGHT,t/CANVAS_WIDTH),i=Math.round(CANVAS_WIDTH*n),(n=Math.round(CANVAS_HEIGHT*n))<e?(n+=r=e-n,i+=CANVAS_WIDTH/CANVAS_HEIGHT*r):i<t&&(i+=r=t-i,n+=CANVAS_HEIGHT/CANVAS_WIDTH*r),r=e/2-n/2,((a=t/2-i/2)*(s=CANVAS_WIDTH/i)<-EDGEBOARD_X||r*s<-EDGEBOARD_Y)&&(n=Math.min(e/(CANVAS_HEIGHT-2*EDGEBOARD_Y),t/(CANVAS_WIDTH-2*EDGEBOARD_X)),i=Math.round(CANVAS_WIDTH*n),r=(e-(n=Math.round(CANVAS_HEIGHT*n)))/2,a=(t-i)/2,s=CANVAS_WIDTH/i),s_iOffsetX=-1*a*s,s_iOffsetY=0<=r?0:-1*r*s,0<=a&&(s_iOffsetX=0),null!==s_oGame&&s_oGame.refreshButtonPos(),null!==s_oMenu&&s_oMenu.refreshButtonPos(),null!==s_oBetPanel&&s_oBetPanel.refreshButtonPos(),s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*i,s_oStage.canvas.height=2*n,canvas.style.width=i+"px",canvas.style.height=n+"px",s_iScaleFactor=2*Math.min(i/CANVAS_WIDTH,n/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor):s_bMobile?($("#canvas").css("width",i+"px"),$("#canvas").css("height",n+"px")):(s_oStage.canvas.width=i,s_oStage.canvas.height=n,s_iScaleFactor=Math.min(i/CANVAS_WIDTH,n/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor),r<0||(r=(e-n)/2),$("#canvas").css("top",r+"px"),$("#canvas").css("left",a+"px"),fullscreenHandler())}function _checkOrientation(e,t){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(t<e?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()))}function createBitmap(e,t,i){var n=new createjs.Bitmap(e),r=new createjs.Shape;return t&&i?r.graphics.beginFill("#fff").drawRect(0,0,t,i):r.graphics.beginFill("#ff0").drawRect(0,0,e.width,e.height),n.hitArea=r,n}function createSprite(e,t,i,n,r,a){return e=null!==t?new createjs.Sprite(e,t):new createjs.Sprite(e),(t=new createjs.Shape).graphics.beginFill("#000000").drawRect(-i,-n,r,a),e.hitArea=t,e}function randomFloatBetween(e,t,i){return void 0===i&&(i=2),parseFloat(Math.min(e+Math.random()*(t-e),t).toFixed(i))}function formatTime(e){e/=1e3;var t=Math.floor(e/60),i=t<10?"0"+t+":":t+":";return(e=Math.floor(e-60*t))<10?i+"0"+e:i+e}function NoClickDelay(e){this.element=e,window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(e){for(var t,i,n=e.length;0<n;)i=Math.floor(Math.random()*n),t=e[--n],e[n]=e[i],e[i]=t;return e}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var n=t[i].split("=");if(n[0]==e)return n[1]}}function playSound(e,t,i){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[e].play(),s_aSounds[e].volume(t),s_aSounds[e].loop(i),s_aSounds[e]):null}function stopSound(e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].stop()}function setVolume(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].volume(t)}function setMute(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].mute(t)}function pauseSound(e){s_aSounds[e].pause()}function easeLinear(e,t,i,n){return i*e/n+t}function collisionWithCircle(e,t,i){var n=e.getX()-t.getX(),r=e.getY()-t.getY();return Math.sqrt(n*n+r*r)<e.getCollision()*i+t.getCollision()*i}function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oBetPanel)&&s_oBetPanel.resetFullscreenBut()}function CSpriteLibrary(){var n,r,a,s,o,l,_={};this.init=function(e,t,i){n={},a=r=0,s=e,o=t,l=i},this.addSprite=function(e,t){var i;_.hasOwnProperty(e)||(i=new Image,_[e]=n[e]={szPath:t,oSprite:i,bLoaded:!1},r++)},this.getSprite=function(e){return _.hasOwnProperty(e)?_[e].oSprite:null},this._onSpritesLoaded=function(){r=0,o.call(l)},this._onSpriteLoaded=function(){s.call(l),++a===r&&this._onSpritesLoaded()},this.loadSprites=function(){for(var e in n)n[e].oSprite.oSpriteLibrary=this,n[e].oSprite.szKey=e,n[e].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey),this.oSpriteLibrary._onSpriteLoaded(this.szKey)},n[e].oSprite.onerror=function(e){var t=e.currentTarget;setTimeout(function(){n[t.szKey].oSprite.src=n[t.szKey].szPath},500)},n[e].oSprite.src=n[e].szPath},this.setLoaded=function(e){_[e].bLoaded=!0},this.isLoaded=function(e){return _[e].bLoaded},this.getNumSprites=function(){return r}}!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),$(window).resize(function(){sizeHandler()}),window.addEventListener("orientationchange",onOrientationChange),NoClickDelay.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e)}},onTouchStart:function(e){e.preventDefault(),this.moved=!1,this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)},onTouchMove:function(e){this.moved=!0},onTouchEnd:function(e){var t;this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),this.moved||(3==(e=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)).nodeType&&(e=e.parentNode),(t=document.createEvent("MouseEvents")).initEvent("click",!0,!0),e.dispatchEvent(t))}},Array.prototype.sortOn=function(){var r,e=this.slice();return arguments.length?(r=Array.prototype.slice.call(arguments),e.sort(function(e,t){for(var i=r.slice(),n=i.shift();e[n]==t[n]&&i.length;)n=i.shift();return e[n]==t[n]?0:e[n]>t[n]?1:-1})):e.sort()},function(){function e(e){var t={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};(e=e||window.event).type in t?document.body.className=t[e.type]:(document.body.className=this[i]?"hidden":"visible",s_bFocus="hidden"===document.body.className?(s_oMain.stopUpdate(),!1):(s_oMain.startUpdate(),!0))}var i="hidden";i in document?document.addEventListener("visibilitychange",e):(i="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(i="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(i="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e}(),screenfull.isEnabled&&screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oBetPanel&&s_oBetPanel.resetFullscreenBut()});var CHIP_VALUES,BET_PANEL_WIDTH,BET_PANEL_HEIGHT,NUM_CHIPS,NUM_HORSES,MIN_BET,MAX_BET,WIN_OCCURRENCE,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,SHOW_CREDITS,CANVAS_WIDTH=1216,CANVAS_HEIGHT=832,EDGEBOARD_X=40,EDGEBOARD_Y=172,FPS=30,FPS_TIME=1e3/FPS,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="impactregular",SECONDARY_FONT="ds-digitalbold",TERTIARY_FONT="motorwerkregular",STATE_LOADING=0,STATE_MENU=1,STATE_BET_PANEL=2,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,FICHE_WIDTH=44,COLOR_FICHES="#ff7706 #ffb600 #000 #06a800 #d50000 #444444".split(" "),BET_PANEL_X=40,BET_PANEL_Y=165,HORSE_WIDTH=326,HORSE_HEIGHT=212,NUM_TRACK_BG=397,ARRIVAL_X=477,TIME_CHECK_RANK=2e3,HORSE_DATA={horse_names:"engineer;pin;doughnut;mayhem;last things;chatterbox;hypno;croquette".split(";"),odd_win_bet:[3.7,5.5,2.2,11.75,17.25,8.75,7.15,6.15],odd_place_bet:[1.95,2.55,1.25,5.5,7.75,3.05,2.5,2.05],odd_show_bet:[1.25,1.7,1.09,2.55,4,1.75,1.55,1.35],forecast:[{first:1,second:2,odd:20},{first:1,second:3,odd:6.25},{first:1,second:4,odd:60},{first:1,second:5,odd:80},{first:1,second:6,odd:23},{first:1,second:7,odd:20},{first:1,second:8,odd:15},{first:2,second:1,odd:28},{first:2,second:3,odd:10.25},{first:2,second:4,odd:65},{first:2,second:5,odd:68},{first:2,second:6,odd:58},{first:2,second:7,odd:42},{first:2,second:8,odd:32},{first:3,second:1,odd:5.75},{first:3,second:2,odd:8.75},{first:3,second:4,odd:26},{first:3,second:5,odd:31},{first:3,second:6,odd:19},{first:3,second:7,odd:15},{first:3,second:8,odd:10},{first:4,second:1,odd:84},{first:4,second:2,odd:56},{first:4,second:3,odd:23},{first:4,second:5,odd:80},{first:4,second:6,odd:65},{first:4,second:7,odd:55},{first:4,second:8,odd:40},{first:5,second:1,odd:70},{first:5,second:2,odd:70},{first:5,second:3,odd:68},{first:5,second:4,odd:84},{first:5,second:6,odd:80},{first:5,second:7,odd:70},{first:5,second:8,odd:50},{first:6,second:1,odd:48},{first:6,second:2,odd:58},{first:6,second:3,odd:13},{first:6,second:4,odd:70},{first:6,second:5,odd:80},{first:6,second:7,odd:55},{first:6,second:8,odd:40},{first:7,second:1,odd:40},{first:7,second:2,odd:50},{first:7,second:3,odd:10},{first:7,second:4,odd:50},{first:7,second:5,odd:55},{first:7,second:6,odd:40},{first:7,second:8,odd:35},{first:8,second:1,odd:38},{first:8,second:2,odd:48},{first:8,second:3,odd:8},{first:8,second:4,odd:50},{first:8,second:5,odd:40},{first:8,second:6,odd:35},{first:8,second:7,odd:30}]},SOUNDTRACK_VOLUME_IN_GAME=1;function CGameSettings(e){var i,r,a,s,n,o,t,l,_;this._init=function(e){e=(_=e).horse_names,NUM_HORSES=e.length,i=[];for(var t=0;t<NUM_HORSES;t++)i[t]=e[t];this._initSimpleOdd(),this._initForecastOdd(),this._initPaths(),this._initHorseInfo(),o=CHIP_VALUES},this._initSimpleOdd=function(){var e=_.odd_win_bet,t=_.odd_place_bet,i=_.odd_show_bet;r=[],a=[],s=[];for(var n=0;n<e.length;n++)r[n]=e[n],a[n]=t[n],s[n]=i[n]},this._initForecastOdd=function(){var e=_.forecast;n=[];for(var t=0;t<NUM_HORSES;t++)n[t]=[];for(t=0;t<e.length;t++)n[e[t].first-1][e[t].second-1]=e[t].odd},this._initPaths=function(){(t=[]).push({place_1:[{x:230,frame:30},{x:500,frame:160},{x:600,frame:190},{x:400,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:30},{x:600,frame:180},{x:650,frame:190},{x:450,frame:180},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:170,frame:30},{x:400,frame:130},{x:450,frame:220},{x:400,frame:140},{x:300,frame:130},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:140},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:340,frame:130},{x:360,frame:310},{x:ARRIVAL_X-HORSE_WIDTH/2-390,frame:320},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:350,frame:260},{x:480,frame:200},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-450,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:30},{x:260,frame:270},{x:ARRIVAL_X-HORSE_WIDTH/2-600,frame:490},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:220,frame:30},{x:290,frame:270},{x:ARRIVAL_X-HORSE_WIDTH/2-800,frame:490},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:190,frame:30},{x:200,frame:270},{x:ARRIVAL_X-HORSE_WIDTH/2-1e3,frame:490},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:30},{x:450,frame:180},{x:500,frame:170},{x:400,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:30},{x:600,frame:200},{x:550,frame:180},{x:350,frame:170},{x:ARRIVAL_X-HORSE_WIDTH/2-200,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:170,frame:30},{x:250,frame:150},{x:350,frame:210},{x:450,frame:140},{x:350,frame:120},{x:ARRIVAL_X-HORSE_WIDTH/2-350,frame:140},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:300,frame:150},{x:360,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-490,frame:310},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:350,frame:280},{x:400,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:30},{x:160,frame:280},{x:ARRIVAL_X-HORSE_WIDTH/2-700,frame:480},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:220,frame:30},{x:200,frame:270},{x:-70,frame:190},{x:20,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-850,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:210,frame:30},{x:0,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-900,frame:470},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:30},{x:500,frame:180},{x:600,frame:180},{x:600,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:30},{x:600,frame:200},{x:650,frame:180},{x:500,frame:180},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:170,frame:30},{x:400,frame:150},{x:450,frame:210},{x:300,frame:140},{x:350,frame:130},{x:ARRIVAL_X-HORSE_WIDTH/2-300,frame:130},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:340,frame:150},{x:360,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-460,frame:310},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:350,frame:280},{x:480,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-550,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:30},{x:200,frame:280},{x:ARRIVAL_X-HORSE_WIDTH/2-560,frame:480},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:200,frame:30},{x:100,frame:270},{x:80,frame:190},{x:20,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-850,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:210,frame:30},{x:20,frame:280},{x:ARRIVAL_X-HORSE_WIDTH/2-1e3,frame:480},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:330,frame:30},{x:450,frame:180},{x:550,frame:170},{x:650,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:30},{x:350,frame:200},{x:450,frame:180},{x:600,frame:170},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:30},{x:400,frame:150},{x:450,frame:200},{x:600,frame:140},{x:500,frame:130},{x:ARRIVAL_X-HORSE_WIDTH/2-350,frame:140},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:290,frame:30},{x:340,frame:150},{x:360,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-510,frame:310},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:150,frame:280},{x:400,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-550,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:30},{x:60,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:470},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:220,frame:30},{x:90,frame:280},{x:420,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-850,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:210,frame:30},{x:120,frame:280},{x:ARRIVAL_X-HORSE_WIDTH/2-900,frame:480},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:30},{x:350,frame:180},{x:400,frame:170},{x:600,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:30},{x:350,frame:200},{x:450,frame:170},{x:500,frame:180},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:210},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:30},{x:400,frame:150},{x:450,frame:200},{x:600,frame:140},{x:500,frame:130},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:140},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:340,frame:140},{x:360,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-390,frame:320},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:350,frame:270},{x:400,frame:190},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-550,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:30},{x:260,frame:280},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:480},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:240,frame:30},{x:350,frame:270},{x:400,frame:190},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-750,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:180,frame:30},{x:260,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-1050,frame:470},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:50},{x:350,frame:200},{x:400,frame:100},{x:500,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:240},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:100},{x:350,frame:150},{x:450,frame:140},{x:500,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:50},{x:400,frame:140},{x:450,frame:200},{x:400,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:340,frame:160},{x:360,frame:300},{x:380,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-390,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:100},{x:350,frame:200},{x:400,frame:190},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-550,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:50},{x:260,frame:300},{x:300,frame:190},{x:220,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:150},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:200,frame:100},{x:300,frame:200},{x:400,frame:190},{x:300,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-750,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:230,frame:50},{x:280,frame:290},{x:300,frame:200},{x:240,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-780,frame:150},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:50},{x:430,frame:320},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:420},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:100},{x:350,frame:150},{x:450,frame:140},{x:500,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:50},{x:200,frame:140},{x:450,frame:400},{x:ARRIVAL_X-HORSE_WIDTH/2-350,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:30},{x:240,frame:160},{x:360,frame:300},{x:380,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-490,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:100},{x:350,frame:200},{x:400,frame:190},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:50},{x:260,frame:300},{x:300,frame:210},{x:220,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-750,frame:130},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:260,frame:100},{x:350,frame:200},{x:300,frame:190},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-850,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:10,frame:50},{x:260,frame:270},{x:300,frame:200},{x:200,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-950,frame:170},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:230,frame:50},{x:250,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:50},{x:430,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:50},{x:330,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-450,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:190,frame:50},{x:230,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-590,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:50},{x:300,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:210,frame:50},{x:130,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-750,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:180,frame:50},{x:280,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-800,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:190,frame:50},{x:150,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-950,frame:450},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:210,frame:50},{x:130,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:220,frame:50},{x:300,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:50},{x:330,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-250,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:250,frame:50},{x:430,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-390,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:190,frame:50},{x:190,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-550,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:230,frame:50},{x:250,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:190,frame:50},{x:220,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-950,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:200,frame:50},{x:250,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-1e3,frame:440},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]}),t.push({place_1:[{x:330,frame:30},{x:450,frame:180},{x:550,frame:180},{x:650,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:30}],place_2:[{x:250,frame:90},{x:450,frame:300},{x:600,frame:200},{x:ARRIVAL_X-HORSE_WIDTH/2-150,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:35}],place_3:[{x:270,frame:30},{x:400,frame:150},{x:450,frame:200},{x:600,frame:140},{x:500,frame:130},{x:ARRIVAL_X-HORSE_WIDTH/2-300,frame:140},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:40}],place_4:[{x:290,frame:30},{x:340,frame:150},{x:360,frame:300},{x:ARRIVAL_X-HORSE_WIDTH/2-510,frame:310},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:45}],place_5:[{x:220,frame:30},{x:350,frame:280},{x:400,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-650,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:50}],place_6:[{x:310,frame:30},{x:400,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-750,frame:470},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:55}],place_7:[{x:240,frame:30},{x:300,frame:280},{x:350,frame:180},{x:320,frame:100},{x:ARRIVAL_X-HORSE_WIDTH/2-800,frame:200},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:60}],place_8:[{x:210,frame:30},{x:300,frame:290},{x:ARRIVAL_X-HORSE_WIDTH/2-850,frame:470},{x:CANVAS_WIDTH+HORSE_WIDTH,frame:65}]})},this._initHorseInfo=function(){(l=[])[0]={start:new createjs.Point(193,350),scale:.53},l[1]={start:new createjs.Point(170,360),scale:.59},l[2]={start:new createjs.Point(144,372),scale:.65},l[3]={start:new createjs.Point(114,385),scale:.71},l[4]={start:new createjs.Point(76,400),scale:.78},l[5]={start:new createjs.Point(30,415),scale:.85},l[6]={start:new createjs.Point(-10,432),scale:.92},l[7]={start:new createjs.Point(-66,452),scale:1}},this.getIndexForFiches=function(e){for(var t=0,i=0;i<o.length;i++)o[i]===e&&(t=i);return t},this.getHorsePercentageArray=function(){for(var e=[],t=0;t<r.length;t++)for(var i=Math.floor(r[t]),n=0;n<i;n++)e.push(t);return shuffle(e)},this.getHorseName=function(e){return i[e]},this.getAllHorseNames=function(){return i},this.getOddWin=function(e){return r[e]},this.getOddPlace=function(e){return a[e]},this.getOddShow=function(e){return s[e]},this.getForecastOdd=function(e,t){return n[e][t]},this.getRandomPath=function(){return t[Math.floor(Math.random()*t.length)]},this.getHorseInfo=function(e){return l[e]},(s_oGameSettings=this)._init(e)}var s_oGameSettings=null;function CPreloader(){var t,i,n,r,a,s,o,l,_,c;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png"),s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg"),s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png"),s_oSpriteLibrary.loadSprites(),c=new createjs.Container,s_oStage.addChild(c)},this.unload=function(){c.removeAllChildren(),_.unload()},this._onImagesLoaded=function(){},this._onAllImagesLoaded=function(){this.attachSprites(),s_oMain.preloaderReady()},this.attachSprites=function(){var e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(e),e=s_oSpriteLibrary.getSprite("200x200"),(o=createBitmap(e)).regX=.5*e.width,o.regY=.5*e.height,o.x=CANVAS_WIDTH/2,o.y=CANVAS_HEIGHT/2-140,c.addChild(o),(l=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(o.x-100,o.y-100,200,200,10),c.addChild(l),o.mask=l,e=s_oSpriteLibrary.getSprite("progress_bar"),(r=createBitmap(e)).x=CANVAS_WIDTH/2-e.width/2,r.y=CANVAS_HEIGHT/2+90,c.addChild(r),t=e.width,i=e.height,(a=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRect(r.x,r.y,1,i),c.addChild(a),r.mask=a,(n=new createjs.Text("","30px "+PRIMARY_FONT,"#fff")).x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2+140,n.textBaseline="alphabetic",n.textAlign="center",c.addChild(n),e=s_oSpriteLibrary.getSprite("but_start"),(_=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+40,e,TEXT_PRELOADER_CONTINUE,"Arial","#000",50,c)).addEventListener(ON_MOUSE_UP,this._onButStartRelease,this),_.setVisible(!1),(s=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(s),createjs.Tween.get(s).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(s),c.removeChild(s)})},this._onButStartRelease=function(){s_oMain._onRemovePreloader()},this.refreshLoader=function(e){n.text=e+"%",100===e&&(s_oMain._onRemovePreloader(),n.visible=!1,r.visible=!1),a.graphics.clear(),e=Math.floor(e*t/100),a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(r.x,r.y,e,i)},this._init()}function CMain(e){var i,t,n,r=0,a=0,s=STATE_LOADING;this.initContainer=function(){s_oCanvas=document.getElementById("canvas"),(s_oStage=new createjs.Stage(s_oCanvas)).preventSelection=!1,createjs.Touch.enable(s_oStage,!0),!1===(s_bMobile=isMobile())&&s_oStage.enableMouseOver(10),s_iPrevTime=(new Date).getTime(),createjs.Ticker.addEventListener("tick",this._update),createjs.Ticker.setFPS(FPS),navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0),s_oSpriteLibrary=new CSpriteLibrary,t=new CPreloader},this.preloaderReady=function(){s_oGameSettings=new CGameSettings(HORSE_DATA),s_oBetList=new CBetList,s_oMain._loadImages(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_oMain._initSounds(),i=!0},this.soundLoaded=function(){r++,t.refreshLoader(Math.floor(r/a*100))},this._initSounds=function(){Howler.mute(!s_bAudioActive),(s_aSoundsInfo=[]).push({path:"./sounds/",filename:"chip",loop:!1,volume:1,ingamename:"chip"}),s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"}),s_aSoundsInfo.push({path:"./sounds/",filename:"start_race",loop:!1,volume:1,ingamename:"start_race"}),s_aSoundsInfo.push({path:"./sounds/",filename:"photo",loop:!1,volume:1,ingamename:"photo"}),s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"}),a+=s_aSoundsInfo.length,s_aSounds=[];for(var e=0;e<s_aSoundsInfo.length;e++)this.tryToLoadSound(s_aSoundsInfo[e],!1)},this.tryToLoadSound=function(e,t){setTimeout(function(){s_aSounds[e.ingamename]=new Howl({src:[e.path+e.filename+".mp3"],autoplay:!1,preload:!0,loop:e.loop,volume:e.volume,onload:s_oMain.soundLoaded,onloaderror:function(e,t){for(var i=0;i<s_aSoundsInfo.length;i++)if(e===s_aSounds[s_aSoundsInfo[i].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[i],!0);break}},onplayerror:function(e){for(var t=0;t<s_aSoundsInfo.length;t++)if(e===s_aSounds[s_aSoundsInfo[t].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[t].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[t].ingamename].play(),"soundtrack"===s_aSoundsInfo[t].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},t?200:0)},this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg"),s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png"),s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png"),s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png"),s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png"),s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png"),s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png"),s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png"),s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png"),s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png"),s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png"),s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png"),s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png"),s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png"),s_oSpriteLibrary.addSprite("fiche_0","./sprites/fiche_0.png"),s_oSpriteLibrary.addSprite("fiche_1","./sprites/fiche_1.png"),s_oSpriteLibrary.addSprite("fiche_2","./sprites/fiche_2.png"),s_oSpriteLibrary.addSprite("fiche_3","./sprites/fiche_3.png"),s_oSpriteLibrary.addSprite("fiche_4","./sprites/fiche_4.png"),s_oSpriteLibrary.addSprite("fiche_5","./sprites/fiche_5.png"),s_oSpriteLibrary.addSprite("bg_bet_panel","./sprites/bg_bet_panel.jpg"),s_oSpriteLibrary.addSprite("money_panel","./sprites/money_panel.png"),s_oSpriteLibrary.addSprite("simple_bet_panel","./sprites/simple_bet_panel.png"),s_oSpriteLibrary.addSprite("forecast_panel","./sprites/forecast_panel.png"),s_oSpriteLibrary.addSprite("bet_place","./sprites/bet_place.png"),s_oSpriteLibrary.addSprite("fiche_highlight","./sprites/fiche_highlight.png"),s_oSpriteLibrary.addSprite("odd_bg","./sprites/odd_bg.png"),s_oSpriteLibrary.addSprite("rank_panel","./sprites/rank_panel.png"),s_oSpriteLibrary.addSprite("panel_arrival","./sprites/panel_arrival.png"),s_oSpriteLibrary.addSprite("bibs","./sprites/bibs.png"),s_oSpriteLibrary.addSprite("but_skip","./sprites/but_skip.png"),s_oSpriteLibrary.addSprite("logo_menu","./sprites/logo_menu.png"),s_oSpriteLibrary.addSprite("but_start_race","./sprites/but_start_race.png"),s_oSpriteLibrary.addSprite("but_clear_bet","./sprites/but_clear_bet.png"),s_oSpriteLibrary.addSprite("fiche_panel","./sprites/fiche_panel.png"),s_oSpriteLibrary.addSprite("fill_bar","./sprites/fill_bar.png"),s_oSpriteLibrary.addSprite("win_panel","./sprites/win_panel.png"),s_oSpriteLibrary.addSprite("lose_panel","./sprites/lose_panel.png");for(var e=0;e<NUM_HORSES;e++)s_oSpriteLibrary.addSprite("bib_gui_"+e,"./sprites/bib_gui_"+e+".png"),s_oSpriteLibrary.addSprite("horse_"+(e+1)+"_a","./sprites/horse_"+(e+1)+"_a.png"),s_oSpriteLibrary.addSprite("horse_"+(e+1)+"_b","./sprites/horse_"+(e+1)+"_b.png"),s_oSpriteLibrary.addSprite("cage_"+e,"./sprites/cage_"+e+".png"),s_oSpriteLibrary.addSprite("gate_"+e,"./sprites/cage_gates/gate_"+e+".png");for(s_oSpriteLibrary.addSprite("cage_"+NUM_HORSES,"./sprites/cage_"+NUM_HORSES+".png"),s_oSpriteLibrary.addSprite("gate_"+NUM_HORSES,"./sprites/cage_gates/gate_"+NUM_HORSES+".png"),e=0;e<NUM_TRACK_BG;e++)s_oSpriteLibrary.addSprite("bg_track_"+e,"./sprites/bg_track/bg_track_"+e+".jpg");a+=s_oSpriteLibrary.getNumSprites(),s_oSpriteLibrary.loadSprites()},this._onImagesLoaded=function(){r++,t.refreshLoader(Math.floor(r/a*100))},this._onAllImagesLoaded=function(){},this._onRemovePreloader=function(){try{saveItem("ls_available","ok")}catch(e){s_bStorageAvailable=!1}t.unload(),s_oSoundTrack=playSound("soundtrack",1,!0),this.gotoMenu()},this.setMoney=function(e){},this.gotoMenu=function(){new CMenu,s=STATE_MENU},this.gotoBetPanel=function(){new CBetPanel,s=STATE_BET_PANEL,$(s_oMain).trigger("start_session")},this.gotoGame=function(e){n=new CGame(e),s=STATE_GAME},this.stopUpdate=function(){i=!1,createjs.Ticker.paused=!0,$("#block_game").css("display","block"),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)},this.startUpdate=function(){s_iPrevTime=(new Date).getTime(),i=!0,createjs.Ticker.paused=!1,$("#block_game").css("display","none"),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||!s_bAudioActive||Howler.mute(!1)},this._update=function(e){var t;!1!==i&&(t=(new Date).getTime(),s_iTimeElaps=t-s_iPrevTime,s_iCntFps++,s_iPrevTime=t,1e3<=(s_iCntTime+=s_iTimeElaps)&&(s_iCurFps=s_iCntFps,s_iCntTime-=1e3,s_iCntFps=0),s===STATE_GAME&&n.update(),s_oStage.update(e))},s_oMain=this,s_iCurMoney=e.money,s_iGameCash=e.game_cash,CHIP_VALUES=e.chip_values,MIN_BET=e.min_bet,MAX_BET=e.max_bet,WIN_OCCURRENCE=e.win_occurrence,AD_SHOW_COUNTER=e.num_levels_for_ads,SHOW_CREDITS=e.show_credits,ENABLE_FULLSCREEN=e.fullscreen,ENABLE_CHECK_ORIENTATION=e.check_orientation,NUM_CHIPS=CHIP_VALUES.length,s_bAudioActive=e.audio_enable_on_startup,this.initContainer()}var s_bMobile,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_iCurMoney,s_iGameCash,s_aSounds,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oSoundTrack=null,s_bStorageAvailable=!0,s_iAdCounter=0;function CTextButton(e,t,i,n,r,a,s,o){var l,_,c,d,u,f,h,p,S,m;this._init=function(e,t,i,n,r,a,s){l=!1,_=1,c=[],d=[],m=createBitmap(i),(p=new createjs.Container).x=e,p.y=t,p.regX=i.width/2,p.regY=i.height/2,s_bMobile||(p.cursor="pointer"),p.addChild(m,S),o.addChild(p),S=new CTLText(p,10,5,i.width-20,i.height-10,s,"center",a,r,1,0,0,n,!0,!0,!1,!1),this._initListener()},this.unload=function(){p.off("mousedown",u),p.off("pressup",f),o.removeChild(p)},this.setVisible=function(e){p.visible=e},this.setAlign=function(e){S.textAlign=e},this.setTextX=function(e){S.x=e},this.setScale=function(e){_=p.scaleX=p.scaleY=e},this.enable=function(){l=!1},this.disable=function(){l=!0},this._initListener=function(){u=p.on("mousedown",this.buttonDown),f=p.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){c[e]=t,d[e]=i},this.addEventListenerWithParams=function(e,t,i,n){c[e]=t,d[e]=i,h=n},this.buttonRelease=function(){l||(playSound("click",1,!1),p.scaleX=_,p.scaleY=_,c[ON_MOUSE_UP]&&c[ON_MOUSE_UP].call(d[ON_MOUSE_UP],h))},this.buttonDown=function(){l||(p.scaleX=.9*_,p.scaleY=.9*_,c[ON_MOUSE_DOWN]&&c[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN]))},this.setPosition=function(e,t){p.x=e,p.y=t},this.tweenPosition=function(e,t,i,n,r,a,s){createjs.Tween.get(p).wait(n).to({x:e,y:t},i,r).call(function(){void 0!==a&&a.call(s)})},this.changeText=function(e){S.refreshText(e)},this.setX=function(e){p.x=e},this.setY=function(e){p.y=e},this.getButtonImage=function(){return p},this.getX=function(){return p.x},this.getY=function(){return p.y},this.getSprite=function(){return p},this.getScale=function(){return p.scaleX},this._init(e,t,i,n,r,a,s)}function CToggle(e,t,i,n,r){var a,s,o,l,_,c,d;this._init=function(e,t,i,n,r){d=void 0!==r?r:s_oStage,s=[],o=[],r=new createjs.SpriteSheet({images:[i],frames:{width:i.width/2,height:i.height,regX:i.width/2/2,regY:i.height/2},animations:{state_true:[0],state_false:[1]}}),(l=createSprite(r,"state_"+(a=n),i.width/2/2,i.height/2,i.width/2,i.height)).x=e,l.y=t,l.stop(),s_bMobile||(l.cursor="pointer"),d.addChild(l),this._initListener()},this.unload=function(){l.off("mousedown",_),l.off("pressup",c),d.removeChild(l)},this._initListener=function(){_=l.on("mousedown",this.buttonDown),c=l.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){s[e]=t,o[e]=i},this.setCursorType=function(e){l.cursor=e},this.setActive=function(e){a=e,l.gotoAndStop("state_"+a)},this.buttonRelease=function(){l.scaleX=1,playSound("click",l.scaleY=1,0),a=!a,l.gotoAndStop("state_"+a),s[ON_MOUSE_UP]&&s[ON_MOUSE_UP].call(o[ON_MOUSE_UP],a)},this.buttonDown=function(){l.scaleX=.9,l.scaleY=.9,s[ON_MOUSE_DOWN]&&s[ON_MOUSE_DOWN].call(o[ON_MOUSE_DOWN])},this.setPosition=function(e,t){l.x=e,l.y=t},this._init(e,t,i,n,r)}function CGfxButton(e,t,i,n){var r,a,s,o,l,_,c,d,u=!1,f=(this._init=function(e,t,i){r=[],a=[],o=[],(s=createBitmap(i)).x=e,s.y=t,_=l=1,s.regX=i.width/2,s.regY=i.height/2,s_bMobile||(s.cursor="pointer"),f.addChild(s),this._initListener()},this.unload=function(){createjs.Tween.removeTweens(s),s.off("mousedown",c),s.off("pressup",d),f.removeChild(s)},this.setVisible=function(e){s.visible=e},this.setCursorType=function(e){s.cursor=e},this._initListener=function(){c=s.on("mousedown",this.buttonDown),d=s.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){r[e]=t,a[e]=i},this.addEventListenerWithParams=function(e,t,i,n){r[e]=t,a[e]=i,o[e]=n},this.buttonRelease=function(){u||(s.scaleX=0<l?l:-l,s.scaleY=_,playSound("click",1,0),r[ON_MOUSE_UP]&&r[ON_MOUSE_UP].call(a[ON_MOUSE_UP],o[ON_MOUSE_UP]))},this.buttonDown=function(){u||(s.scaleX=0<l?.9*l:.9*-l,s.scaleY=.9*_,r[ON_MOUSE_DOWN]&&r[ON_MOUSE_DOWN].call(a[ON_MOUSE_DOWN],o[ON_MOUSE_DOWN]))},this.rotation=function(e){s.rotation=e},this.getButton=function(){return s},this.setPosition=function(e,t){s.x=e,s.y=t},this.setX=function(e){s.x=e},this.setY=function(e){s.y=e},this.getButtonImage=function(){return s},this.block=function(e){u=e,s.scaleX=l,s.scaleY=_},this.setScaleX=function(e){l=s.scaleX=e},this.setScale=function(e){_=l=e,s.scaleX=s.scaleY=e},this.getX=function(){return s.x},this.getY=function(){return s.y},this.pulseAnimation=function(){createjs.Tween.get(s,{loop:-1}).to({scaleX:.9*l,scaleY:.9*_},850,createjs.Ease.quadOut).to({scaleX:l,scaleY:_},650,createjs.Ease.quadIn)},this.removeAllTweens=function(){createjs.Tween.removeTweens(s)},void 0!==n?n:s_oStage);return this._init(e,t,i),this}function CMenu(){var i,n,r,a,s,o,l,_,c,d,u,f,h,p,S,m,x,e=null,b=null,g=null;this._init=function(){u=createBitmap(s_oSpriteLibrary.getSprite("bg_menu")),s_oStage.addChild(u);var e=s_oSpriteLibrary.getSprite("but_play"),t=(c=CANVAS_WIDTH/2,d=CANVAS_HEIGHT-e.height/2-10,(f=new CGfxButton(c,d,e)).addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),e=s_oSpriteLibrary.getSprite("but_credits"),a=SHOW_CREDITS?(s=10+e.width/2,o=e.height/2+10,(S=new CGfxButton(s,o,e)).addEventListener(ON_MOUSE_UP,this._onCredits,this),r=s+e.width+10,o):(r=10+e.width/2,e.height/2+10),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(e=s_oSpriteLibrary.getSprite("audio_icon"),l=CANVAS_WIDTH-e.width/4-10,_=e.height/2+10,(p=new CToggle(l,_,e,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this)),(e=window.document).documentElement);b=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,g=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen,(b=!1===ENABLE_FULLSCREEN?!1:b)&&screenfull.isEnabled&&(e=s_oSpriteLibrary.getSprite("but_fullscreen"),(m=new CToggle(r,a,e,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this)),e=s_oSpriteLibrary.getSprite("logo_menu"),i=CANVAS_WIDTH/2,n=10,(x=createBitmap(e)).regX=e.width/2,x.x=i,x.y=n,s_oStage.addChild(x),(h=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStage.addChild(h),createjs.Tween.get(h).to({alpha:0},1e3).call(function(){s_oStage.removeChild(h)}),this.refreshButtonPos()},this.unload=function(){f.unload(),f=null,SHOW_CREDITS&&S.unload(),s_oStage.removeChild(u),u=null,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(p.unload(),p=null),b&&screenfull.isEnabled&&m.unload(),s_oMenu=null},this.refreshButtonPos=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||p.setPosition(l-s_iOffsetX,_+s_iOffsetY),b&&screenfull.isEnabled&&m.setPosition(r+s_iOffsetX,a+s_iOffsetY),f.setPosition(c,d-s_iOffsetY),SHOW_CREDITS&&S.setPosition(s+s_iOffsetX,o+s_iOffsetY),null!==e&&e.refreshButtonPos(),x.y=n+s_iOffsetY},this.exitFromCredits=function(){e=null},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onCredits=function(){e=new CCreditsPanel},this._onButPlayRelease=function(){this.unload(),s_oMain.gotoBetPanel()},this.resetFullscreenBut=function(){b&&screenfull.isEnabled&&m.setActive(s_bFullscreen)},this._onFullscreenRelease=function(){s_bFullscreen?g.call(window.document):b.call(window.document.documentElement),sizeHandler()},(s_oMenu=this)._init()}var s_oMenu=null;function CGame(t){var i,n,r,a,s,o,l,_,c,d,u,f,h,p,S,m,x,b,g,e;this._init=function(){a=r=i=!1,l=o=0,h=s_oGameSettings.getAllHorseNames(),setVolume("soundtrack",0),s_oTweenController=new CTweenController,p=new createjs.Container,s_oStage.addChild(p),m=new CTrackBg(p),b=new CRankingGui(h,s_oStage),g=new CArrivalPanel(CANVAS_WIDTH,246,s_oStage),x=new CInterface,this.generateFinalRank(),this._prepareHorses(),(S=new createjs.Shape).graphics.beginFill("white").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),S.alpha=0,s_oStage.addChild(S),$(s_oMain).trigger("start_level",1),(e=new createjs.Text("","40px "+PRIMARY_FONT,"#000")).textAlign="center",e.textBaseline="alphabetic",e.x=CANVAS_WIDTH/2,e.y=220,setTimeout(function(){s_oGame.startRace()},1e3),playSound("start_race",1,0),this.refreshButtonPos()},this.unload=function(){stopSound("start_race"),x.unload(),createjs.Tween.removeAllTweens(),s_oStage.removeAllChildren(),s_oGame=null},this.refreshButtonPos=function(){x.refreshButtonPos(s_iOffsetX,s_iOffsetY),b.refreshButtonPos(s_iOffsetX,s_iOffsetY),g.refreshButtonPos(s_iOffsetX,s_iOffsetY)},this.pause=function(){i=!1,pauseSound("start_race");for(var e=0;e<NUM_HORSES;e++)d[e].pauseAnim()},this.unpause=function(){i=!0,playSound("start_race");for(var e=0;e<NUM_HORSES;e++)d[e].unpauseAnim()},this.onExit=function(){setVolume("soundtrack",1),s_oGame.unload(),s_oMain.gotoMenu(),$(s_oMain).trigger("end_session"),$(s_oMain).trigger("show_interlevel_ad"),$(s_oMain).trigger("share_event",[s_iCurMoney])},this.gotoBetPanel=function(){setVolume("soundtrack",1),s_oGame.unload(),s_oMain.gotoBetPanel()},this.startRace=function(){for(var e=0;e<f.length;e++)f[e].playAnim();x.blockExit(!1),i=!0,m.startTrack(),setTimeout(function(){s_oGame.startHorses()},100)},this.generateFinalRank=function(){!(s_oBetList.getMinWin()>s_iGameCash)&&100*Math.random()<WIN_OCCURRENCE?this._generateWinResult():this._generateLosingResult(),s=parseFloat(s.toFixed(2))},this._generateWinResult=function(){n=!0;do{_=this._generateRandomRank();var e=s_oBetList.getTotWinWithCurRank(_)}while((s=e.tot_win)<=t);c=e.win_list},this._generateLosingResult=function(){n=!1;do{_=this._generateRandomRank();var e=s_oBetList.getTotWinWithCurRank(_)}while(s=e.tot_win,t<s);c=e.win_list},this._generateRandomRank=function(){for(var e=[],t=s_oGameSettings.getHorsePercentageArray();e.length<NUM_HORSES;){var i=t[Math.floor(Math.random()*t.length)];e.unshift(i);for(var n=t.length-1;0<=n;)t[n]===i&&t.splice(n,1),n--}return e},this._prepareHorses=function(){u=[],f=[],d=[];for(var e=s_oGameSettings.getRandomPath(),t=[{x:266,y:233},{x:248,y:234},{x:229,y:235},{x:208,y:237},{x:183,y:239},{x:154,y:241},{x:120,y:244},{x:83,y:246},{x:62,y:249}],i=0;i<NUM_HORSES;i++){var n=createBitmap(s_oSpriteLibrary.getSprite("cage_"+i)),r=(p.addChild(n),u.push(n),n=s_oGameSettings.getHorseInfo(i),_.indexOf(i));d[i]=new CHorse(n.start,i+1,h[i],n.scale,e["place_"+(r+1)],p),n=new CGate(t[i].x,t[i].y,i,p),f.push(n)}n=createBitmap(s_oSpriteLibrary.getSprite("cage_"+NUM_HORSES)),p.addChild(n),u.push(n),n=new CGate(t[NUM_HORSES].x,t[NUM_HORSES].y,NUM_HORSES,p),f.push(n)},this.startHorses=function(){for(var e=0;e<NUM_HORSES;e++)d[e].startRace()},this.horsePhotofinish=function(e,t){x.blockExit(!0),g.refreshRank(e,t),++o<4?(i=!1,l=TIME_CHECK_RANK,this._playFlashAnim()):6===o&&(n||0<s?(s_iCurMoney+=s,s_iGameCash-=s,s_iCurMoney=parseFloat(s_iCurMoney.toFixed(2)),s_iGameCash=parseFloat(s_iGameCash.toFixed(2)),x.showWinPanel(s,c,_)):x.showLosePanel(_),stopSound("start_race"),setVolume("soundtrack",1),$(s_oMain).trigger("save_score",s_iCurMoney))},this.checkHorseArrival=function(){r=!0,this._refreshRank()},this._playFlashAnim=function(){for(var e=0;e<NUM_HORSES;e++)d[e].pauseAnim();playSound("photo",1,0),createjs.Tween.get(S).to({alpha:.8},200).call(function(){var e=(new createjs.ColorMatrix).adjustSaturation(-100);p.filters=[new createjs.ColorMatrixFilter(e)],p.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),a=!0,createjs.Tween.get(S).to({alpha:0},400).call(function(){s_oGame.restoreRaceAfterFlash()})})},this.restoreRaceAfterFlash=function(){setTimeout(function(){for(var e=0;e<NUM_HORSES;e++)d[e].unpauseAnim();p.filters=[],p.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),i=!0},1e3)},this.moveCages=function(e){if(4===e){for(var t=0;t<u.length;t++)p.removeChild(u[t]);for(t=0;t<f.length;t++)f[t].unload()}else{for(var i=[123,255,370],t=0;t<u.length;t++)u[t].x-=i[e-1];for(t=0;t<f.length;t++)f[t].decreaseX(i[e-1])}},this._refreshRank=function(){for(var e=[],t=0;t<NUM_HORSES;t++){var i=d[t].getX();e[t]={index:t,x:i}}e.sort(this.compareXPos),b.refreshRank(e)},this.compareXPos=function(e,t){return e.x>t.x?-1:e.x<t.x?1:0},this.returnInBetPanel=function(){++s_iAdCounter===AD_SHOW_COUNTER&&(s_iAdCounter=0,$(s_oMain).trigger("show_interlevel_ad")),s_oGame.gotoBetPanel()},this.update=function(){if(i){var e=m.update();for(b.refreshRadar(e),e=0;e<NUM_HORSES;e++)d[e].update(r);a&&p.updateCache(),TIME_CHECK_RANK<(l+=s_iTimeElaps)&&!r&&(l=0,this._refreshRank())}},(s_oGame=this)._init()}var s_oTweenController,s_oGame=null;function CInterface(){var i,n,r,a,s,o,l,_,c,d,u,f,h=null,p=null;return this._init=function(){var e=s_oSpriteLibrary.getSprite("but_exit"),t=(i=CANVAS_WIDTH-e.width/2-10,n=e.height/2+10,(c=new CGfxButton(i,n,e)).block(!0),c.addEventListener(ON_MOUSE_UP,this._onExit,this),a=!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(e=s_oSpriteLibrary.getSprite("audio_icon"),s=i-e.width/2-10,(l=new CToggle(s,o=n,e,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),r=s-e.width/2-10,o):(r=i-e.width-10,n),(e=window.document).documentElement);h=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,p=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen,(h=!1===ENABLE_FULLSCREEN?!1:h)&&screenfull.isEnabled&&(e=s_oSpriteLibrary.getSprite("but_fullscreen"),(_=new CToggle(r,a,e,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this)),u=new CLosePanel(s_oStage),d=new CWinPanel(s_oStage),f=new CAreYouSurePanel(s_oStage)},this.refreshButtonPos=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(s-s_iOffsetX,o+s_iOffsetY),h&&screenfull.isEnabled&&_.setPosition(r-s_iOffsetX,a+s_iOffsetY),c.setPosition(i-s_iOffsetX,n+s_iOffsetY)},this.showWinPanel=function(e,t,i){d.show(e,t,i)},this.showLosePanel=function(e){u.show(e)},this.unload=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l.unload(),l=null),h&&screenfull.isEnabled&&_.unload(),d.unload(),u.unload(),f.unload(),s_oInterface=null},this.blockExit=function(e){c.block(e)},this._onExit=function(){s_oGame.pause(),f.show()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this.resetFullscreenBut=function(){h&&screenfull.isEnabled&&_.setActive(s_bFullscreen)},this._onFullscreenRelease=function(){s_bFullscreen?p.call(window.document):h.call(window.document.documentElement),sizeHandler()},(s_oInterface=this)._init(),this}var s_oInterface=null;function CCreditsPanel(){var t,i,n,r,a;this._init=function(){a=new createjs.Container,s_oStage.addChild(a),n=createBitmap(s_oSpriteLibrary.getSprite("msg_box")),a.addChild(n),(i=new createjs.Shape).graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),i.alpha=.01,r=i.on("click",this._onLogoButRelease),a.addChild(i);var e=s_oSpriteLibrary.getSprite("but_exit");(t=new CGfxButton(815,284,e,a)).addEventListener(ON_MOUSE_UP,this.unload,this),e=s_oSpriteLibrary.getSprite("logo_ctl"),(n=createBitmap(e)).regX=e.width/2,n.regY=e.height/2,n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2-50,a.addChild(n),(n=new createjs.Text("www.hahaha.com","36px "+PRIMARY_FONT,"#fff")).textAlign="center",n.textBaseline="alphabetic",n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2+120,a.addChild(n)},this.unload=function(){i.off("click",r),t.unload(),t=null,s_oStage.removeChild(a),s_oMenu.exitFromCredits()},this._onLogoButRelease=function(){window.open("http://www.hahaha.com/index.php?&l=en","_blank")},this._init()}function CBetPanel(){var i,n,r,a,s,o,l,_,c,d,u,f,h,p,S,m,x,b,g,T,A,E=null,H=null;this._init=function(){c=l=0,u=[],A=new createjs.Container,s_oStage.addChild(A);var e,t=createBitmap(s_oSpriteLibrary.getSprite("bg_bet_panel"));A.addChild(t),t=s_oSpriteLibrary.getSprite("but_exit"),s=CANVAS_WIDTH-t.width/2-10,o=t.height/2+10,(b=new CGfxButton(s,o,t,A)).addEventListener(ON_MOUSE_UP,this.onExit,this),n=!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(e=s_oSpriteLibrary.getSprite("audio_icon"),r=s-t.width-10,a=e.height/2+10,(g=new CToggle(r,a,e,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),i=r-e.width/2-10,a):(i=s-t.width-10,o),e=(t=window.document).documentElement,E=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,H=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen,(E=!1===ENABLE_FULLSCREEN?!1:E)&&screenfull.isEnabled&&(e=s_oSpriteLibrary.getSprite("but_fullscreen"),(f=new CToggle(i,n,e,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this)),t=s_oSpriteLibrary.getSprite("simple_bet_panel"),BET_PANEL_WIDTH=t.width,BET_PANEL_HEIGHT=t.height,(T=new createjs.Container).x=BET_PANEL_X,T.y=BET_PANEL_Y,A.addChild(T),(d=[])[0]=new CSimpleBetPanel(0,0,T),d[1]=new CForecastPanel(BET_PANEL_WIDTH,0,T),m=new CChipPanel(1010,326,A),(h=new createjs.Shape).graphics.beginFill("rgba(255,255,255,0.01)").drawRect(BET_PANEL_X+6,BET_PANEL_Y,BET_PANEL_WIDTH-12,BET_PANEL_HEIGHT),A.addChild(h),T.mask=h,_=0,(p=new CGfxButton(BET_PANEL_X+8,CANVAS_HEIGHT/2,s_oSpriteLibrary.getSprite("arrow_left"),A)).addEventListener(ON_MOUSE_UP,this._onArrowLeft,this),(S=new CGfxButton(BET_PANEL_X+t.width-10,CANVAS_HEIGHT/2,s_oSpriteLibrary.getSprite("arrow_right"),A)).addEventListener(ON_MOUSE_UP,this._onArrowRight,this),x=new CMsgBox,s_oBetList.reset(),this.refreshButtonPos()},this.unload=function(){p.unload(),S.unload(),b.unload(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||g.unload(),E&&screenfull.isEnabled&&f.unload(),x.unload(),m.unload();for(var e=0;e<d.length;e++)d[e].unload();s_oStage.removeAllChildren()},this.refreshButtonPos=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||g.setPosition(r-s_iOffsetX,a+s_iOffsetY),E&&screenfull.isEnabled&&f.setPosition(i-s_iOffsetX,n+s_iOffsetY),b.setPosition(s-s_iOffsetX,o+s_iOffsetY)},this.setChipSelected=function(e){c=e},this.setMoney=function(e){s_iCurMoney=e,m.refreshMoney()},this.setSimpleBet=function(e,t,i,n){return s_iCurMoney<i?(x.show(TEXT_NO_MONEY,!0),!1):MAX_BET<l+i?(x.show(TEXT_ERR_MAX_BET,!1),!1):(s_oBetList.addSimpleBet(e,t,i),l+=i,l=Number(l.toFixed(2)),s_iCurMoney-=i,s_iCurMoney=parseFloat(s_iCurMoney.toFixed(2)),s_iGameCash+=i,s_iGameCash=parseFloat(s_iGameCash.toFixed(2)),m.refreshMoney(),m.refreshBet(l),u.push(n),!0)},this.setForecastBet=function(e,t,i,n){return s_iCurMoney<i?(x.show(TEXT_NO_MONEY,!0),!1):MAX_BET<l+i?(x.show(TEXT_ERR_MAX_BET,!1),!1):(s_oBetList.addForecastBet(e,t,i),l+=i,l=Number(l.toFixed(2)),s_iCurMoney-=i,s_iCurMoney=parseFloat(s_iCurMoney.toFixed(2)),s_iGameCash+=i,s_iGameCash=parseFloat(s_iGameCash.toFixed(2)),m.refreshMoney(),m.refreshBet(l),u.push(n),!0)},this.refreshPagePos=function(e,t){T.x=BET_PANEL_X,d[_].setX(0),d[e].setX(t)},this.clearBet=function(){for(var e=0;e<u.length;e++)u[e].clearBet();s_iCurMoney+=l,s_iCurMoney=parseFloat(s_iCurMoney.toFixed(2)),s_iGameCash-=l,s_iGameCash=parseFloat(s_iGameCash.toFixed()),d[l=0].clearBet(),s_oBetList.reset(),m.refreshBet(0),m.refreshMoney()},this._onArrowLeft=function(){var e=_;++_===d.length&&(_=0,e=d.length-1),d[_].setX(BET_PANEL_WIDTH),createjs.Tween.get(T).to({x:-BET_PANEL_WIDTH+BET_PANEL_X},500,createjs.Ease.cubicOut).call(function(){s_oBetPanel.refreshPagePos(e,BET_PANEL_WIDTH)})},this._onArrowRight=function(){var e=_;--_<0&&(_=d.length-1),d[_].setX(-BET_PANEL_WIDTH),createjs.Tween.get(T).to({x:BET_PANEL_X+BET_PANEL_WIDTH},500,createjs.Ease.cubicOut).call(function(){s_oBetPanel.refreshPagePos(e,-BET_PANEL_WIDTH)})},this.onStartExit=function(){l<MIN_BET?x.show(TEXT_ERR_MIN_BET,!1):(this.unload(),s_oMain.gotoGame(l),$(s_oMain).trigger("bet_placed",l))},this.onExit=function(){$(s_oMain).trigger("end_session"),this.unload(),s_oMain.gotoMenu()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this.resetFullscreenBut=function(){E&&screenfull.isEnabled&&f.setActive(s_bFullscreen)},this._onFullscreenRelease=function(){s_bFullscreen?H.call(window.document):E.call(window.document.documentElement),sizeHandler()},this.getChipSelected=function(){return c},(s_oBetPanel=this)._init()}var s_oBetPanel=null;function CChipPanel(e,t,i){this._init=function(e,t){(l=new createjs.Container).x=e,l.y=t,_.addChild(l),new CTextButton(73,2,s_oSpriteLibrary.getSprite("but_clear_bet"),TEXT_CLEAR_BET,PRIMARY_FONT,"#fff",24,l).addEventListener(ON_MOUSE_UP,this._onClearBet,this);e=s_oSpriteLibrary.getSprite("money_panel"),t=createBitmap(s_oSpriteLibrary.getSprite("money_panel"));t.regX=e.width/2,t.x=73,t.y=22,l.addChild(t),new CTLText(l,18,32,110,14,14,"center","#ffde00",SECONDARY_FONT,1,0,0,TEXT_MIN_BET+": "+MIN_BET+TEXT_CURRENCY,!0,!0,!1,!1),new CTLText(l,18,44,110,14,14,"center","#ffde00",SECONDARY_FONT,1,0,0,TEXT_MAX_BET+": "+MAX_BET+TEXT_CURRENCY,!0,!0,!1,!1),(t=createBitmap(s_oSpriteLibrary.getSprite("money_panel"))).regX=e.width/2,t.x=73,t.y=72,l.addChild(t),new CTLText(l,5,74,40,12,12,"left","#fff",TERTIARY_FONT,1,0,0,TEXT_BET,!0,!0,!1,!1),s=new CTLText(l,18,82,110,26,26,"center","#ffde00",SECONDARY_FONT,1,0,0,"0"+TEXT_CURRENCY,!0,!0,!1,!1),(t=createBitmap(e)).regX=e.width/2,t.x=73,t.y=122,l.addChild(t),new CTLText(l,5,124,40,12,12,"left","#fff",TERTIARY_FONT,1,0,0,TEXT_MONEY,!0,!0,!1,!1),a=new CTLText(l,18,132,110,26,26,"center","#ffde00",SECONDARY_FONT,1,0,0,s_iCurMoney+TEXT_CURRENCY,!0,!0,!1,!1),this._initChips(),(o=new CButStartRace(73,304,s_oSpriteLibrary.getSprite("but_start_race"),TEXT_START_RACE,"#fff",24,l)).addEventListener(ON_MOUSE_UP,this._onStartRace,this)},this.unload=function(){for(var e=0;e<n;e++)n[e].unload();o.unload()},this._initChips=function(){var e=createBitmap(s_oSpriteLibrary.getSprite("fiche_panel"));e.x=0,e.y=170,l.addChild(e),e=[{x:46,y:220},{x:97,y:220},{x:145,y:220},{x:46,y:264},{x:97,y:264},{x:145,y:264}],n=[];for(var t=0;t<NUM_CHIPS;t++)n[t]=new CFicheBut(t,e[t].x,e[t].y,1,l),n[t].addEventListenerWithParams(ON_MOUSE_UP,this._onFicheClicked,this,t);e=s_oSpriteLibrary.getSprite("fiche_highlight"),(r=createBitmap(e)).regX=e.width/2,r.regY=e.height/2,r.x=n[0].getX()-22,r.y=n[0].getY()-23,l.addChild(r)},this.refreshMoney=function(){a.refreshText(s_iCurMoney+TEXT_CURRENCY)},this.refreshBet=function(e){s.refreshText(e+TEXT_CURRENCY)},this._onStartRace=function(){s_oBetPanel.onStartExit()},this._onClearBet=function(){s_oBetPanel.clearBet()},this._onFicheClicked=function(e){r.x=n[e].getX()-22,r.y=n[e].getY()-23,s_oBetPanel.setChipSelected(e)};var n,r,a,s,o,l,_=i;this._init(e,t)}function CSimpleBetPanel(e,t,i){this._init=function(e,t){(_=new createjs.Container).x=e,_.y=t,c.addChild(_);var i=createBitmap(s_oSpriteLibrary.getSprite("simple_bet_panel"));_.addChild(i),new CTLText(_,25,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_TRAP,!0,!0,!1,!1),new CTLText(_,140,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_WINS,!0,!0,!1,!1),new CTLText(_,250,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_PLACE,!0,!0,!1,!1),new CTLText(_,360,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SHOW,!0,!0,!1,!1),new CTLText(_,475,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_TRAP,!0,!0,!1,!1),new CTLText(_,585,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_WINS,!0,!0,!1,!1),new CTLText(_,695,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_PLACE,!0,!0,!1,!1),new CTLText(_,805,10,100,20,20,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SHOW,!0,!0,!1,!1);for(var i=s_oSpriteLibrary.getSprite("bibs"),n=new createjs.SpriteSheet({images:[i],frames:{width:i.width/4,height:i.height/2},animations:{bib_0:[0],bib_1:[1],bib_2:[2],bib_3:[3],bib_4:[4],bib_5:[5],bib_6:[6],bib_7:[7]}}),r=35,a=23,s=0;s<NUM_HORSES;s++){var o=createSprite(n,"bib_"+s,0,0,i.width/3,i.height/2);o.x=a,o.y=r,o.scaleX=o.scaleY=.5,_.addChild(o),s===NUM_HORSES/2-1?(a=470,r=35):r+=i.height/2+45}this._initHorseInfos(),this._initBetPlaces()},this._initHorseInfos=function(){var e=s_oGameSettings.getAllHorseNames();s=[];for(var t=18,i=55,n=0;n<NUM_HORSES;n++){var r=s_oSpriteLibrary.getSprite("horse_"+(n+1)+"_a"),a=s_oSpriteLibrary.getSprite("horse_"+(n+1)+"_b");(r=createSprite(r=new createjs.SpriteSheet({images:[r,a],frames:[[1,1,249,191,0,-56,-19],[252,1,307,193,0,-8,-19],[561,1,308,196,0,-4,-16],[1,199,307,198,0,-2,-14],[310,199,306,201,0,-1,-11],[618,199,307,205,0,0,-7],[1,406,305,209,0,-1,-3],[308,406,304,211,0,-3,-1],[614,406,301,209,0,-8,0],[1,619,295,207,0,-17,-2],[298,619,295,204,0,-19,-5],[595,619,301,203,0,-21,-8],[1,1,284,200,1,-35,-11],[287,1,293,198,1,-31,-14],[582,1,306,196,1,-20,-16]],animations:{idle:[1,1],anim:[1,14],start:[15],anim_1:[1,14,"anim"],anim_2:[6,14,"anim"],anim_3:[11,14,"anim"]}}),"idle",HORSE_WIDTH/2,HORSE_HEIGHT,HORSE_WIDTH,HORSE_HEIGHT)).x=t,r.y=i,r.scaleX=r.scaleY=.36,_.addChild(r),s.push(r),new CTLText(_,t+4,i+80,100,14,14,"left","#fff",TERTIARY_FONT,1,0,0,e[n].toUpperCase(),!0,!0,!1,!1),n===NUM_HORSES/2-1?(t=468,i=55):i+=115}},this._initBetPlaces=function(){o=[],l=[],a=[];for(var e=150,t=75,i=s_oSpriteLibrary.getSprite("bet_place"),n=0;n<NUM_HORSES;n++){var r=new createjs.Text(s_oGameSettings.getOddWin(n),"20px "+PRIMARY_FONT,"#fff");r.textAlign="center",r.textBaseline="middle",r.x=e+38,r.y=t+54,_.addChild(r),(r=new CButBet(r.x+2,t,i,.7,_)).addEventListenerWithParams(ON_MOUSE_UP,this._onWinClicked,this,n),a.push(r),(r=new createjs.Text(s_oGameSettings.getOddPlace(n),"20px "+PRIMARY_FONT,"#fff")).textAlign="center",r.textBaseline="middle",r.x=e+150,r.y=t+54,_.addChild(r),(r=new CButBet(r.x+2,t,i,.7,_)).addEventListenerWithParams(ON_MOUSE_UP,this._onPlaceClicked,this,n),o.push(r),(r=new createjs.Text(s_oGameSettings.getOddShow(n),"20px "+PRIMARY_FONT,"#fff")).textAlign="center",r.textBaseline="middle",r.x=e+260,r.y=t+54,_.addChild(r),(r=new CButBet(r.x+2,t,i,.7,_)).addEventListenerWithParams(ON_MOUSE_UP,this._onShowClicked,this,n),l.push(r),n===NUM_HORSES/2-1?(e=596,t=75):t+=116}},this.unload=function(){for(var e=0;e<o.length;e++)a[e].unload(),l[e].unload(),o[e].unload()},this.setX=function(e){_.x=e},this.clearBet=function(){for(var e=0;e<s.length;e++)s[e].gotoAndStop("idle")},this._onWinClicked=function(e){var t=CHIP_VALUES[s_oBetPanel.getChipSelected()];s_oBetPanel.setSimpleBet(e,1,t,a[e])&&("anim"!==s[e].currentAnimation&&s[e].gotoAndPlay("anim"),a[e].increaseBet(t))},this._onPlaceClicked=function(e){var t=CHIP_VALUES[s_oBetPanel.getChipSelected()];s_oBetPanel.setSimpleBet(e,2,t,o[e])&&("anim"!==s[e].currentAnimation&&s[e].gotoAndPlay("anim"),o[e].increaseBet(t))},this._onShowClicked=function(e){var t=CHIP_VALUES[s_oBetPanel.getChipSelected()];s_oBetPanel.setSimpleBet(e,3,t,l[e])&&("anim"!==s[e].currentAnimation&&s[e].gotoAndPlay("anim"),l[e].increaseBet(t))},this.getContainer=function(){return _};var s,a,o,l,_,c=i;this._init(e,t)}function CForecastPanel(t,i,e){this._init=function(){(f=new createjs.Container).x=t,f.y=i,n.addChild(f);var e=createBitmap(s_oSpriteLibrary.getSprite("forecast_panel"));f.addChild(e),this._initForecastBets()},this.unload=function(){for(var e in u)-1<e.indexOf("forecast_")&&u[e].unload()},this._initForecastBets=function(){u=[];for(var e=[{x:26,y:5},{x:250,y:5},{x:474,y:5},{x:698,y:5},{x:26,y:252},{x:250,y:252},{x:474,y:252},{x:698,y:252}],t=0;t<NUM_HORSES;t++)this._placeForecastBetForHorse(t,e[t].x,e[t].y)},this._placeForecastBetForHorse=function(e,t,i){for(var n,r,a,s=s_oSpriteLibrary.getSprite("odd_bg"),o=s_oSpriteLibrary.getSprite("bet_place"),l=(c=s_oSpriteLibrary.getSprite("bibs")).width/4,_=c.height/2,c=new createjs.SpriteSheet({images:[c],frames:{width:l,height:_},animations:{bib_0:[0],bib_1:[1],bib_2:[2],bib_3:[3],bib_4:[4],bib_5:[5],bib_6:[6],bib_7:[7]}}),d=0;d<NUM_HORSES;d++)d!==e&&((n=createSprite(c,"bib_"+e,0,0,l,_)).x=t,n.y=i,n.scaleX=n.scaleY=.55,f.addChild(n),(r=new createjs.Text("X","12px "+PRIMARY_FONT,"#fff")).textAlign="center",r.textBaseline="middle",r.x=t+.55*l+10,r.y=i+.55*_/2,f.addChild(r),(a=createSprite(c,"bib_"+d,0,0,l/3,_/2)).x=r.x+10,a.y=n.y,a.scaleX=a.scaleY=.55,f.addChild(a),(r=createBitmap(s)).x=a.x+.55*l+10,r.y=n.y+2,f.addChild(r),(n=new createjs.Text(s_oGameSettings.getForecastOdd(e,d),"18px "+PRIMARY_FONT,"#fff")).textAlign="center",n.textBaseline="alphabetic",n.x=r.x+s.width/2,n.y=r.y+s.height/2+8,f.addChild(n),(n=new CButBet(r.x+s.width+.72*o.width/2+5,r.y+.72*o.height/2-2,o,.45,f)).setScale(.6),n.addEventListenerWithParams(ON_MOUSE_UP,this._onForecastClicked,this,{first:e,second:d}),u["forecast_"+e+"_"+d]=n,i+=.55*(_-14)+3)},this.setX=function(e){f.x=e},this._onForecastClicked=function(e){var t=CHIP_VALUES[s_oBetPanel.getChipSelected()];s_oBetPanel.setForecastBet(e.first,e.second,t,u["forecast_"+e.first+"_"+e.second])&&u["forecast_"+e.first+"_"+e.second].increaseBet(t)};var u,f,n=e;this._init(t,i)}function CBetList(){var r,a,s;this._init=function(){this.reset()},this.reset=function(){r=[];for(var e=0;e<NUM_HORSES;e++)r[e]=[],r[e].place_1=0,r[e].place_2=0,r[e].place_3=0;for(a=[],e=0;e<NUM_HORSES;e++){a[e]=[];for(var t=0;t<NUM_HORSES;t++)a[e][t]=0}s=[]},this.addSimpleBet=function(e,t,i){r[e]["place_"+t]+=i;var n=0;switch(t){case 1:n=i*s_oGameSettings.getOddWin(e);break;case 2:n=i*s_oGameSettings.getOddPlace(e);break;case 3:n=i*s_oGameSettings.getOddShow(e)}s.push({type_bet:"simple",horses:[{index:e,place:t}],bet:i,win:n})},this.addForecastBet=function(e,t,i){a[e][t]+=i,s.push({type_bet:"forecast",horses:[{index:e,place:1},{index:t,place:2}],bet:i,win:i*s_oGameSettings.getForecastOdd(e,t)})},this.getMinWin=function(){if(0<s.length){for(var e=s[0].win,t=1;t<s.length;t++)e>s[t].win&&(e=s[t].win);return e}return 0},this.getTotWinWithCurRank=function(e){var t,i=0,n=[];return 0<r[e[0]].place_1&&(t=r[e[0]].place_1*s_oGameSettings.getOddWin(e[0]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[0],bet:r[e[0]].place_1,type:"win"})),0<r[e[0]].place_2&&(t=r[e[0]].place_2*s_oGameSettings.getOddPlace(e[0]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[0],bet:r[e[0]].place_2,type:"place"})),0<r[e[1]].place_2&&(t=r[e[1]].place_2*s_oGameSettings.getOddPlace(e[1]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[1],bet:r[e[1]].place_2,type:"place"})),0<r[e[0]].place_3&&(t=r[e[0]].place_3*parseFloat(s_oGameSettings.getOddShow(e[0])),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[0],bet:r[e[0]].place_3,type:"show"})),0<r[e[1]].place_3&&(t=r[e[1]].place_3*s_oGameSettings.getOddShow(e[1]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[1],bet:r[e[1]].place_3,type:"show"})),0<r[e[2]].place_3&&(t=r[e[2]].place_3*s_oGameSettings.getOddShow(e[2]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:e[2],bet:r[e[2]].place_3,type:"show"})),0<a[e[0]][e[1]]&&(t=a[e[0]][e[1]]*s_oGameSettings.getForecastOdd(e[0],e[1]),i+=t=parseFloat(t.toFixed(2)),n.push({win:t,horses:[e[0],e[1]],bet:a[e[0]][e[1]],type:"forecast"})),{tot_win:i,win_list:n}},(s_oBetList=this)._init()}var s_oBetList=null;function CFichesController(o,e){this._init=function(e){_=e,c=new createjs.Container,h.addChild(c),(t=new CVector2).set(c.x,c.y),d=new createjs.Container,h.addChild(d),e*=18,(f=new createjs.Text("",e+"px "+PRIMARY_FONT,"#000")).textAlign="center",d.addChild(f),(u=new createjs.Text("",e+"px "+PRIMARY_FONT,"#fff")).textAlign="center",d.addChild(u),l=r=n=0,i=!1},this.addEventListener=function(e,t,i){},this.reset=function(){i=!1,l=0,c.removeAllChildren(),c.x=t.getX(),c.y=t.getY(),f.text="",u.text=""},this.setPrevValue=function(e){r=e},this.refreshFiches=function(e,t,i){e=e.sortOn("value","index");for(var n=t+FICHE_WIDTH*o/2,r=i+FICHE_WIDTH*o/2,a=l=0,s=0;s<e.length;s++)new CFicheBut(e[s].index,n,r,o,c).disable(),r-=5,9<++a&&(a=0,n+=FICHE_WIDTH,r=i),l+=e[s].value;playSound("chip",1,0),u.x=t,u.y=i+25*_,u.text=l.toFixed(2)+TEXT_CURRENCY,f.x=t+2,f.y=i+27*_,f.text=l.toFixed(2)+TEXT_CURRENCY},this.createFichesPile=function(e,t,i){this.reset();var n=CHIP_VALUES,r=[];do{for(var a=n[n.length-1],s=n.length-1;e<a;)a=n[--s];for(var s=Math.floor(e/a),o=0;o<s;o++)r.push({value:a,index:s_oGameSettings.getIndexForFiches(a)})}while(e=(a=Math.floor(e/a)===e/a?0:e%a).toFixed(2),0<a);this.refreshFiches(r,t,i*_)},this.initMovement=function(e,t){r=l,a=new CVector2(c.x,c.y),s=new CVector2(e,t),u.text="",f.text="",i=!0},this.getValue=function(){return l},this.getPrevBet=function(){return r},this.update=function(e){var t;i&&((n+=e)>TIME_FICHES_MOV?(n=0,i=!1):(e=easeInOutCubic(n,0,1,TIME_FICHES_MOV),t=new CVector2,t=tweenVectors(a,s,e,t),c.x=t.getX(),c.y=t.getY()))};var i,n,l,_,r,t,a,s,c,d,u,f,h=e;this._init(o)}function CButBet(e,t,i,n,r){var a,s,o,l,_,c,d,u,f,h,p,S=!1,m=(this._init=function(e,t,i,n){a=0,s=[],o=[],_=[],(p=new createjs.Container).x=e,p.y=t,m.addChild(p),l=createBitmap(i),d=c=1,l.regX=i.width/2,l.regY=i.height/2,s_bMobile||(l.cursor="pointer"),p.addChild(l),this._initListener(),h=new CFichesController(n,p)},this.unload=function(){createjs.Tween.removeTweens(l),l.off("mousedown",u),l.off("pressup",f),m.removeChild(p)},this.setVisible=function(e){l.visible=e},this.setCursorType=function(e){l.cursor=e},this._initListener=function(){u=l.on("mousedown",this.buttonDown),f=l.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){s[e]=t,o[e]=i},this.addEventListenerWithParams=function(e,t,i,n){s[e]=t,o[e]=i,_[e]=n},this.buttonRelease=function(){S||(l.scaleX=0<c?c:-c,l.scaleY=d,playSound("chip",1,0),s[ON_MOUSE_UP]&&s[ON_MOUSE_UP].call(o[ON_MOUSE_UP],_[ON_MOUSE_UP]))},this.buttonDown=function(){S||(l.scaleX=0<c?.9*c:.9*-c,l.scaleY=.9*d,s[ON_MOUSE_DOWN]&&s[ON_MOUSE_DOWN].call(o[ON_MOUSE_DOWN],_[ON_MOUSE_DOWN]))},this.rotation=function(e){l.rotation=e},this.getButton=function(){return l},this.setPosition=function(e,t){l.x=e,l.y=t},this.setX=function(e){l.x=e},this.setY=function(e){l.y=e},this.getButtonImage=function(){return l},this.block=function(e){S=e,l.scaleX=c,l.scaleY=d},this.setScaleX=function(e){c=l.scaleX=e},this.setScale=function(e){d=c=e,l.scaleX=l.scaleY=e},this.increaseBet=function(e){a+=e,h.createFichesPile(a.toFixed(2),0,-4)},this.clearBet=function(){a=0,h.reset()},this.getX=function(){return l.x},this.getY=function(){return l.y},this.pulseAnimation=function(){createjs.Tween.get(l,{loop:-1}).to({scaleX:.9*c,scaleY:.9*d},850,createjs.Ease.quadOut).to({scaleX:c,scaleY:d},650,createjs.Ease.quadIn)},this.removeAllTweens=function(){createjs.Tween.removeTweens(l)},this.getTotBet=function(){return a},void 0!==r?r:s_oStage);return this._init(e,t,i,n),this}function CVector2(e,t){var i,n;this._init=function(e,t){i=e,n=t},this.add=function(e,t){i+=e,n+=t},this.addV=function(e){i+=e.getX(),n+=e.getY()},this.scalarDivision=function(e){i/=e,n/=e},this.subV=function(e){i-=e.getX(),n-=e.getY()},this.scalarProduct=function(e){i*=e,n*=e},this.invert=function(){i*=-1,n*=-1},this.dotProduct=function(e){return i*e.getX()+n*e.getY()},this.set=function(e,t){i=e,n=t},this.setV=function(e){i=e.getX(),n=e.getY()},this.length=function(){return Math.sqrt(i*i+n*n)},this.length2=function(){return i*i+n*n},this.normalize=function(){var e=this.length();0<e&&(i/=e,n/=e)},this.getNormalize=function(e){this.length(),e.set(i,n),e.normalize()},this.rot90CCW=function(){var e=i;i=-n,n=e},this.rot90CW=function(){var e=i;i=n,n=-e},this.getRotCCW=function(e){e.set(i,n),e.rot90CCW()},this.getRotCW=function(e){e.set(i,n),e.rot90CW()},this.ceil=function(){i=Math.ceil(i),n=Math.ceil(n)},this.round=function(){i=Math.round(i),n=Math.round(n)},this.toString=function(){return"Vector2: "+i+", "+n},this.print=function(){trace("Vector2: "+i+", "+n)},this.getX=function(){return i},this.getY=function(){return n},this._init(e,t)}function CMsgBox(){var e,i,n,r,t;return this._init=function(){(n=new createjs.Container).alpha=0,n.visible=!1,s_oStage.addChild(n),e=createBitmap(s_oSpriteLibrary.getSprite("msg_box")),n.addChild(e),i=new CTLText(n,CANVAS_WIDTH/2-200,CANVAS_HEIGHT/2-100,400,130,34,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!0,!1),(r=new CTextButton(CANVAS_WIDTH/2,500,s_oSpriteLibrary.getSprite("fiche_panel"),TEXT_RECHARGE,PRIMARY_FONT,"#fff",30,n)).setVisible(!1),r.addEventListener(ON_MOUSE_UP,this._onRecharge,this),(t=new CGfxButton(CANVAS_WIDTH/2+205,CANVAS_HEIGHT/2-130,s_oSpriteLibrary.getSprite("but_exit"),n)).addEventListener(ON_MOUSE_UP,this._onExit,this)},this.unload=function(){r.unload(),t.unload()},this.show=function(e,t){i.refreshText(e),n.visible=!0,createjs.Tween.get(n).to({alpha:1},500),t?r.setVisible(!0):r.setVisible(!1)},this._onExit=function(){n.visible=!1},this._onRecharge=function(){$(s_oMain).trigger("recharge"),n.visible=!1},this._init(),this}function CTrackBg(e){this._init=function(){o=new createjs.Container,l.addChild(o),r=3,s=[];for(var e=a=n=0;e<NUM_TRACK_BG;e++){var t=createBitmap(s_oSpriteLibrary.getSprite("bg_track_"+e));t.scaleX=t.scaleY=1.25,0<e&&(t.visible=!1),o.addChild(t),s[e]=t}i=!1},this.startTrack=function(){i=!0},this.update=function(){return i&&++a===r&&(a=0,s[++n].visible=!0,s[n-1].visible=!1,n===s.length-1?(i=!1,s_oGame.checkHorseArrival()):n<5?s_oGame.moveCages(n):r=2),n};var i,n,r,a,s,o,l=e;this._init()}function CHorse(e,t,i,n,r,a){this._init=function(e,t,i,n,r){o=!1,l=t,u=0,f=ARRIVAL_X-HORSE_WIDTH/2*n+70,h=i,p=r,(m=new createjs.Container).x=e.x,m.y=e.y,m.scaleX=m.scaleY=1.25*n,m.regX=HORSE_WIDTH/2,m.regY=HORSE_HEIGHT,x.addChild(m),e=s_oSpriteLibrary.getSprite("horse_"+t+"_a"),t=s_oSpriteLibrary.getSprite("horse_"+t+"_b"),t=new createjs.SpriteSheet({framerate:30,images:[e,t],frames:[[1,1,249,191,0,-56,-19],[252,1,307,193,0,-8,-19],[561,1,308,196,0,-4,-16],[1,199,307,198,0,-2,-14],[310,199,306,201,0,-1,-11],[618,199,307,205,0,0,-7],[1,406,305,209,0,-1,-3],[308,406,304,211,0,-3,-1],[614,406,301,209,0,-8,0],[1,619,295,207,0,-17,-2],[298,619,295,204,0,-19,-5],[595,619,301,203,0,-21,-8],[1,1,284,200,1,-35,-11],[287,1,293,198,1,-31,-14],[582,1,306,196,1,-20,-16]],animations:{idle:[0,0],anim:[1,14],start:[15],anim_1:[1,14,"anim"],anim_2:[6,14,"anim"],anim_3:[11,14,"anim"]}}),S=createSprite(t,"idle",HORSE_WIDTH/2,HORSE_HEIGHT,HORSE_WIDTH,HORSE_HEIGHT),m.addChild(S)},this.startRace=function(){S.gotoAndPlay("anim_"+(Math.floor(3*Math.random())+1)),d=m.x,_=0,c=p[u].frame,s=!0},this.pauseAnim=function(){S.paused=!0},this.unpauseAnim=function(){S.paused=!1},this.getX=function(){return m.x},this.update=function(e){var t;s&&(c<=++_?++u<p.length?(_=0,c=p[u].frame,d=m.x):s=!1:(t=s_oTweenController.easeLinear(_,0,1,c),t=s_oTweenController.tweenValue(d,p[u].x,t),m.x=t),e)&&!o&&m.x>=f&&(o=!0,s_oGame.horsePhotofinish(l-1,h))};var s,o,l,_,c,d,u,f,h,p,S,m,x=a;this._init(e,t,i,n,r)}function CTweenController(){this.tweenValue=function(e,t,i){return e+i*(t-e)},this.easeLinear=function(e,t,i,n){return i*e/n+t},this.easeInCubic=function(e,t,i,n){return t+i*(n=(e/=n)*e*e)},this.easeBackInQuart=function(e,t,i,n){return t+i*(2*(n=(e/=n)*e)*n+2*n*e+-3*n)},this.easeInBack=function(e,t,i,n){return i*(e/=n)*e*(2.70158*e-1.70158)+t},this.easeOutCubic=function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},this.getTrajectoryPoint=function(e,t){var i=new createjs.Point,n=(1-e)*(1-e),r=e*e;return i.x=n*t.start.x+2*(1-e)*e*t.traj.x+r*t.end.x,i.y=n*t.start.y+2*(1-e)*e*t.traj.y+r*t.end.y,i}}function CRankingGui(e,t){this._init=function(e){var t=s_oSpriteLibrary.getSprite("rank_panel");i=CANVAS_HEIGHT-t.height+4,(_=new createjs.Container).x=0,_.y=i,c.addChild(_),t=createBitmap(t),_.addChild(t),(s=[])[0]=new createjs.Point(938,44),s[1]=new createjs.Point(818,44),s[2]=new createjs.Point(695,44),s[3]=new createjs.Point(570,44),s[4]=new createjs.Point(450,44),s[5]=new createjs.Point(320,44),s[6]=new createjs.Point(201,44),s[7]=new createjs.Point(86,44),this._initBibs(e),e=s_oSpriteLibrary.getSprite("fill_bar"),(o=createBitmap(e)).x=130,o.y=114,_.addChild(o),n=e.width,r=n/NUM_TRACK_BG,(l=new createjs.Shape).graphics.beginFill("rgba(255,255,255,0.01)").drawRect(o.x,o.y-2,.01,10),_.addChild(l),o.mask=l,this.refreshButtonPos()},this.refreshButtonPos=function(){_.y=i-s_iOffsetY},this._initBibs=function(e){a=[];for(var t=0;t<NUM_HORSES;t++){var i=new createjs.Container,n=(i.x=s[t].x,i.y=s[t].y,_.addChild(i),createBitmap(s_oSpriteLibrary.getSprite("bib_gui_"+t)));i.addChild(n),new CTLText(i,-5,2,60,12,12,"right","#fff",TERTIARY_FONT,1,0,0,e[t].toUpperCase(),!0,!0,!1,!1),a.push(i)}},this.refreshRank=function(e){for(var t=0;t<e.length;t++)createjs.Tween.get(a[e[t].index]).to({x:s[t].x},1e3,createjs.Ease.cubicOut)},this.refreshRadar=function(e){l.graphics.clear(),l.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(o.x,o.y-2,r*e,10)};var i,n,r,a,s,o,l,_,c=t;this._init(e)}function CArrivalPanel(e,t,i){this._init=function(e,t){d=!1,u=0,_=e,c=t,(p=new createjs.Container).x=_,p.y=c,S.addChild(p);var i=createBitmap(r=s_oSpriteLibrary.getSprite("panel_arrival")),n=(p.addChild(i),l=CANVAS_WIDTH-r.width-s_iOffsetX,i=(r=s_oSpriteLibrary.getSprite("bibs")).width/4,r.height/2),r=new createjs.SpriteSheet({images:[r],frames:{width:i,height:n},animations:{bib_0:[0],bib_1:[1],bib_2:[2],bib_3:[3],bib_4:[4],bib_5:[5],bib_6:[6],bib_7:[7]}});f=[],h=[];for(var a=4,s=0;s<NUM_HORSES;s++){var o=createSprite(r,"bib_0",0,0,i,n);o.x=10,o.y=a,o.visible=!1,o.scaleX=o.scaleY=.45,p.addChild(o),h.push(o),o=new CTLText(p,o.x+.45*i+5,o.y+5,120,20,16,"left","#fff",TERTIARY_FONT,1,0,0," ",!0,!0,!1,!1),f.push(o),a+=.45*n+1}},this.refreshButtonPos=function(){p.x=d?l-s_iOffsetX:_-s_iOffsetX},this.show=function(){d=!0,createjs.Tween.get(p).to({x:l},500,createjs.Ease.cubicOut)},this.hide=function(){d=!1,createjs.Tween.get(p).to({x:_},500,createjs.Ease.cubicOut)},this.refreshRank=function(e,t){f[u].refreshText(t),h[u].gotoAndStop("bib_"+e),h[u].visible=!0,0===u&&this.show(),u++};var l,_,c,d,u,f,h,p,S=i;this._init(e,t)}function CWinPanel(e){this._init=function(){c=new createjs.Container,t=c.on("click",function(){}),c.visible=!1,n.addChild(c);var e=createBitmap(s_oSpriteLibrary.getSprite("win_panel"));c.addChild(e),e=s_oSpriteLibrary.getSprite("bibs"),s=e.width/4,o=e.height/2,l=new createjs.SpriteSheet({images:[e],frames:{width:s,height:o},animations:{bib_0:[0],bib_1:[1],bib_2:[2],bib_3:[3],bib_4:[4],bib_5:[5],bib_6:[6],bib_7:[7]}}),_=new CTLText(c,CANVAS_WIDTH/2+16,470,120,80,30,"center","#ffde00",SECONDARY_FONT,1,0,0,TEXT_WIN,!0,!0,!0,!1),(i=new CGfxButton(800,510,s_oSpriteLibrary.getSprite("but_skip"),c)).addEventListener(ON_MOUSE_UP,this.onSkip,this)},this.unload=function(){c.off("click",t),i.unload()},this.show=function(e,t,i){_.refreshText(TEXT_WIN+"\n"+e+TEXT_CURRENCY),e=240;for(var n=0;n<3;n++){var r=s_oSpriteLibrary.getSprite("horse_"+(i[n]+1)+"_a"),a=s_oSpriteLibrary.getSprite("horse_"+(i[n]+1)+"_b");(r=createSprite(r=new createjs.SpriteSheet({images:[r,a],frames:[[1,1,249,191,0,-56,-19],[252,1,307,193,0,-8,-19],[561,1,308,196,0,-4,-16],[1,199,307,198,0,-2,-14],[310,199,306,201,0,-1,-11],[618,199,307,205,0,0,-7],[1,406,305,209,0,-1,-3],[308,406,304,211,0,-3,-1],[614,406,301,209,0,-8,0],[1,619,295,207,0,-17,-2],[298,619,295,204,0,-19,-5],[595,619,301,203,0,-21,-8],[1,1,284,200,1,-35,-11],[287,1,293,198,1,-31,-14],[582,1,306,196,1,-20,-16]],animations:{idle:[1,1],anim:[1,14],start:[15],anim_1:[1,14,"anim"],anim_2:[6,14,"anim"],anim_3:[11,14,"anim"]}}),"idle",HORSE_WIDTH/2,HORSE_HEIGHT,HORSE_WIDTH,HORSE_HEIGHT)).scaleX=r.scaleY=.35,r.x=CANVAS_WIDTH/2+90,r.y=e,c.addChild(r),e+=68}for(e=CANVAS_HEIGHT/2-150,i=0;i<t.length;i++)n="forecast"===t[i].type?(r=t[i].horses,(a=createSprite(l,"bib_"+r[0],0,0,s,o)).x=380,a.y=e,a.scaleX=a.scaleY=.5,c.addChild(a),(n=new createjs.Text("X","20px "+PRIMARY_FONT,"#fff")).textAlign="center",n.textBaseline="middle",n.x=a.x+.5*s+10,n.y=e+18,c.addChild(n),(r=createSprite(l,"bib_"+r[1],0,0,s,o)).x=n.x+10,r.y=e,r.scaleX=r.scaleY=.5,c.addChild(r),r.x+35):((a=createSprite(l,"bib_"+t[i].horses,0,0,s,o)).x=380,a.y=e,a.scaleX=a.scaleY=.5,c.addChild(a),a.x+35),new CTLText(c,n,e+8,80,20,20,"left","#ffb400",PRIMARY_FONT,1,0,0,t[i].type.toUpperCase(),!0,!0,!1,!1),new CTLText(c,n+84,e+8,80,20,20,"left","#fff",PRIMARY_FONT,1,0,0,TEXT_WIN+": "+t[i].win+TEXT_CURRENCY,!0,!0,!1,!1),e+=35;c.visible=!0,c.alpha=0,createjs.Tween.get(c).wait(1e3).to({alpha:1},500,createjs.Ease.cubicOut)},this.onSkip=function(){s_oGame.returnInBetPanel()};var s,o,l,t,i,_,c,n=e;this._init()}function CLosePanel(e){this._init=function(){(o=new createjs.Container).visible=!1,a=o.on("click",function(){}),l.addChild(o);var e=createBitmap(s_oSpriteLibrary.getSprite("lose_panel"));o.addChild(e),new CTLText(o,CANVAS_WIDTH/2-200,260,400,50,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_NO_WIN,!0,!0,!1,!1),e=s_oSpriteLibrary.getSprite("bibs"),t=e.width/4,i=e.height/2,r=new createjs.SpriteSheet({images:[e],frames:{width:t,height:i},animations:{bib_0:[0],bib_1:[1],bib_2:[2],bib_3:[3],bib_4:[4],bib_5:[5],bib_6:[6],bib_7:[7]}}),n=[],(e=createSprite(r,"bib_0",0,0,t,i)).x=CANVAS_WIDTH/2-100-t/2,e.y=360,o.addChild(e),n.push(e),(e=createSprite(r,"bib_0",0,0,t,i)).x=CANVAS_WIDTH/2-t/2,e.y=360,o.addChild(e),n.push(e),(e=createSprite(r,"bib_0",0,0,t,i)).x=CANVAS_WIDTH/2+100-t/2,e.y=360,o.addChild(e),n.push(e),new CTLText(o,CANVAS_WIDTH/2-120,450,240,30,30,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_WIN+": 0.00 "+TEXT_CURRENCY,!0,!0,!1,!1),(s=new CGfxButton(800,510,s_oSpriteLibrary.getSprite("but_skip"),o)).addEventListener(ON_MOUSE_UP,this.onSkip,this)},this.unload=function(){o.off("click",a),s.unload()},this.show=function(e){for(var t=0;t<3;t++)n[t].gotoAndStop("bib_"+e[t]);o.visible=!0,o.alpha=0,createjs.Tween.get(o).wait(1e3).to({alpha:1},500,createjs.Ease.cubicOut)},this.onSkip=function(){s_oGame.returnInBetPanel()};var t,i,n,r,a,s,o,l=e;this._init()}function CButStartRace(e,t,i,n,r,a,s){this._init=function(e,t,i,n,r,a){o=[],l=[],n=createBitmap(i),(_=new createjs.Container).x=e,_.y=t,_.regX=i.width/2,_.regY=i.height/2,_.addChild(n),u.addChild(_),s_bMobile||(_.cursor="pointer"),this._initListener()},this.unload=function(){_.off("mousedown",c),_.off("pressup",d),u.removeChild(_)},this.setVisible=function(e){_.visible=e},this._initListener=function(){c=_.on("mousedown",this.buttonDown),d=_.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){o[e]=t,l[e]=i},this.buttonRelease=function(){_.scaleX=1,playSound("click",_.scaleY=1,0),o[ON_MOUSE_UP]&&o[ON_MOUSE_UP].call(l[ON_MOUSE_UP])},this.buttonDown=function(){_.scaleX=.9,_.scaleY=.9,o[ON_MOUSE_DOWN]&&o[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])},this.setPosition=function(e,t){_.x=e,_.y=t},this.setX=function(e){_.x=e},this.setY=function(e){_.y=e},this.getButtonImage=function(){return _},this.getX=function(){return _.x},this.getY=function(){return _.y};var o,l,_,c,d,u=s;return this._init(e,t,i,n,r,a),this}function CAreYouSurePanel(e){this._init=function(){r=new createjs.Container,t=r.on("click",function(){}),r.visible=!1,a.addChild(r);var e=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));r.addChild(e),new CTLText(r,CANVAS_WIDTH/2-200,290,400,100,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_YOU_SURE,!0,!0,!0,!1),(i=new CGfxButton(CANVAS_WIDTH/2+180,500,s_oSpriteLibrary.getSprite("but_yes"),r)).addEventListener(ON_MOUSE_UP,this._onReleaseYes,this),(n=new CGfxButton(CANVAS_WIDTH/2-180,500,s_oSpriteLibrary.getSprite("but_no"),r)).addEventListener(ON_MOUSE_UP,this._onReleaseNo,this)},this.unload=function(){r.off("click",t),n.unload(),i.unload()},this.show=function(){r.visible=!0,r.alpha=0,createjs.Tween.get(r).to({alpha:1},500,createjs.Ease.cubicOut)},this._onReleaseYes=function(){s_oGame.onExit()},this._onReleaseNo=function(){r.visible=!1,s_oGame.unpause()};var t,i,n,r,a=e;this._init(e)}function CGate(e,t,i,n){this._init=function(e,t,i){i=s_oSpriteLibrary.getSprite("gate_"+i);var n=new createjs.SpriteSheet({images:[i],frames:{width:i.width/5,height:i.height},animations:{idle:[0,0],anim:[0,4,"stop_anim"],stop_anim:[4,4]}});(r=createSprite(n,"idle",0,0,i.width/5,i.height)).x=e,r.y=t,a.addChild(r)},this.unload=function(){a.removeChild(r)},this.playAnim=function(){r.gotoAndPlay("anim")},this.decreaseX=function(e){r.x-=e};var r,a=n;this._init(e,t,i)}function CTLText(e,t,i,n,r,a,s,o,l,_,c,d,u,f,h,p,S){this._oContainer=e,this._x=t,this._y=i,this._iWidth=n,this._iHeight=r,this._bMultiline=p,this._iFontSize=a,this._szAlign=s,this._szColor=o,this._szFont=l,this._iPaddingH=c,this._iPaddingV=d,this._bVerticalAlign=h,this._bFitText=f,this._bDebug=S,this._oDebugShape=null,this._fLineHeightFactor=_,this._oText=null,u&&this.__createText(u)}function CFicheBut(n,e,t,r,a){var s,o,l,_,c,d=[];this._init=function(e,t){var i=s_oSpriteLibrary.getSprite("fiche_"+n);s=!1,(c=new createjs.Container).x=e,c.y=t,c.regX=i.width/2,c.regY=i.height/2,a.addChild(c),o=[],l=[],(_=createBitmap(i)).regX=i.width/2,_.regY=i.height/2,_.cursor="pointer",c.addChild(_),c.scaleX=c.scaleY=r,new CTLText(c,-10,-10,18,18,20,"center",COLOR_FICHES[n],PRIMARY_FONT,1.1,0,0,CHIP_VALUES[n],!0,!0,!1,!1),this._initListener()},this.unload=function(){c.off("mousedown",this.buttonDown),c.off("pressup",this.buttonRelease),a.removeChild(c)},this.select=function(){},this.deselect=function(){},this.enable=function(){s=!1},this.disable=function(){s=!0},this.setVisible=function(e){c.visible=e},this._initListener=function(){c.on("mousedown",this.buttonDown),c.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,i){o[e]=t,l[e]=i},this.addEventListenerWithParams=function(e,t,i,n){o[e]=t,l[e]=i,d=n},this.buttonRelease=function(){s||(playSound("click",1,!1),c.scaleX=r,c.scaleY=r,o[ON_MOUSE_UP]&&o[ON_MOUSE_UP].call(l[ON_MOUSE_UP],d))},this.buttonDown=function(){s||(c.scaleX=.9*r,c.scaleY=.9*r,o[ON_MOUSE_DOWN]&&o[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],d))},this.setPosition=function(e,t){c.x=e,c.y=t},this.setX=function(e){c.x=e},this.setY=function(e){c.y=e},this.getX=function(){return c.x},this.getY=function(){return c.y},this._init(e,t)}function extractHostname(e){return(e=(e=-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0]).split(":")[0]).split("?")[0]}function extractRootDomain(e){var t=(e=extractHostname(e)).split("."),i=t.length;return e=2<i?t[i-2]+"."+t[i-1]:e}CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var e=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&(this._oText.font=--e+"px "+this._szFont,this._oText.lineHeight=Math.round(e*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),!(e<8)););this._iFontSize=e}},__verticalAlign:function(){var e;this._bVerticalAlign&&(e=this._oText.getBounds().height,this._oText.y-=(e-this._iHeight)/2+this._iPaddingV)},__updateY:function(){this._oText.y=this._y+this._iPaddingV,"middle"===this._oText.textBaseline&&(this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize))},__createText:function(e){switch(this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape)),this._oText=new createjs.Text(e,this._iFontSize+"px "+this._szFont,this._szColor),this._oText.textBaseline="middle",this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this._oText.textAlign=this._szAlign,this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null,this._szAlign){case"center":this._oText.x=this._x+this._iWidth/2;break;case"left":this._oText.x=this._x+this._iPaddingH;break;case"right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText),this.refreshText(e)},setVerticalAlign:function(e){this._bVerticalAlign=e},setOutline:function(e){null!==this._oText&&(this._oText.outline=e)},setShadow:function(e,t,i,n){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(e,t,i,n))},setColor:function(e){this._oText.color=e},setAlpha:function(e){this._oText.alpha=e},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},refreshText:function(e){""===e&&(e=" "),null===this._oText&&this.__createText(e),this._oText.text=e,this._oText.font=this._iFontSize+"px "+this._szFont,this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this.__autofit(),this.__updateY(),this.__verticalAlign()}};var getClosestTop=function(){var e=window,t=!1;try{for(;e.parent.document!==e.document;){if(!e.parent.document){t=!0;break}e=e.parent}}catch(e){t=!0}return{topFrame:e,err:t}},getBestPageUrl=function(e){var t=e.topFrame,i="";if(e.err)try{try{i=window.top.location.href}catch(e){var n=window.location.ancestorOrigins,i=n[n.length-1]}}catch(e){i=t.document.referrer}else i=t.location.href;return i},TOPFRAMEOBJ=getClosestTop(),PAGE_URL=getBestPageUrl(TOPFRAMEOBJ);function seekAndDestroy(){for(var e=extractRootDomain(PAGE_URL),t=[String.fromCharCode(99,111,100,101,116,104,105,115,108,97,98,46,99,111,109),String.fromCharCode(101,110,118,97,116,111,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,110,101,116)],i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}